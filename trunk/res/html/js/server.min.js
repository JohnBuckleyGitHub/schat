var Hosts={body:function(a){Hosts.read(a)},feed:function(a){if(Pages.current!=1||!a.hasOwnProperty("type")||a.own!==true||a.feed!==FEED_NAME_HOSTS){return}try{Hosts[a.type](a.data)}catch(b){}},processSingleHost:function(c,b){var d="#"+c;if(!$(d).length){var a='<tr class="host-row" id="'+c+'"><td class="os-cell"><i class="'+((b.online===true?"icon-status":"icon-status-offline"))+' host-status"></i><a class="host-os" title="'+htmlspecialchars(b.osName)+'"><i class="icon-os os-'+Pages.os(b.os)+'"></i></a></td><td class="host-name">'+htmlspecialchars(b.name)+'</td><td><a class="host-info" rel="tooltip" data-original-title="'+Utils.table({version:b.version,last_ip:b.host})+'"><i class="icon-info"></i></a> <span class="last-activity timeago" title="'+b.date+'">'+DateTime.template(b.date,true)+'</span></td><td><a onclick="" class="btn btn-small btn-unlink" data-tr="unlink" data-id="'+c+'">Unlink</a></td></tr>';$("#account-table > tbody").append(a)}else{$(d).show()}},read:function(b){if(b===false){return}$(".host-row").hide();for(var a in b){if(b.hasOwnProperty(a)&&a.length==34){Hosts.processSingleHost(a,b[a])}}Loader.loadJS("qrc:/js/jquery.timeago."+Utils.tr("lang")+".js",function(){$(".timeago").timeago()});$("#hosts-content p").show();$("#hosts-content #fieldset").show();$(".host-row:hidden").remove();$("a[rel=tooltip]").tooltip();Loader.spinner.remove("loading/hosts");Utils.retranslate()},reload:function(){if(Pages.current!=1){return}if(SimpleChat.isOnline()){Loader.spinner.add("loading/hosts")}var a=SimpleChat.channel(Settings.getId());if(a!==null){$("#info-content > h1").html(Messages.nameTemplate(a))}Utils.TR("my_computers");Hosts.read(SimpleChat.feed(FEED_NAME_HOSTS,1))},progress:false};Pages.onInfo.push(Hosts.reload);try{ChatView.feed.connect(Hosts.feed);ChatView.reload.connect(Hosts.reload)}catch(e){}var AuthDialog={show:function(){Modal.current="auth";Modal.create.auth(null);$("#modal").modal()},providers:function(){var b=Auth.providers();if(!b.hasOwnProperty("order")){return}for(var a=0;a<b.order.length;a++){var c=b.order[a];if(b.providers.hasOwnProperty(c)){AuthDialog.addProvider(c,b.providers[c])}}$("#modal-header h3 .icon-spinner").remove();Utils.adjustWidth($("#providers .btn"))},addProvider:function(a,b){$("#providers").append('<a class="btn" href="'+b.url+' "><i class="provider-'+a+'"></i> '+b.htmlName+"</a>")},hide:function(){$("#modal").modal("hide")}};Modal.create.auth=function(a){$("#modal-header h3 *").remove();$("#modal-body *").remove();$("#modal-header h3").append("<span></span>");$("#modal-header h3").append(' <i class="icon-spinner"></i>');$("#modal-header h3 span").text(Utils.tr("sign_in_with"));$("#modal-header h3 span").attr("data-tr","sign_in_with");$("#modal-body").append('<div id="providers"></div>');if(Auth.anonymous()){$("#modal-body").append('<div id="anonymous-auth"><a data-tr="or_anon_connect" href="#">'+Utils.tr("or_anon_connect")+"</a></div>");$("#anonymous-auth a").on("click",function(b){b.preventDefault();Auth.open()})}AuthDialog.providers()};Modal.shown.auth=function(){Utils.adjustWidth($("#providers .btn"))};Modal.hidden.auth=function(){Auth.cancel()};if(typeof Auth==="undefined"){Auth={providers:function(){return{}},cancel:function(){},anonymous:function(){return true},open:function(){},retry:function(){}}}else{Auth.providersReady.connect(AuthDialog.providers)}var ServerInfo={interval:null,online:function(){Settings.id=SimpleChat.serverId();$("#server-peer").text(SimpleChat.serverPeer());if(Pages.current===1){ServerInfo.setInterval()}Utils.TR("activity");Utils.TR("activity_sent");Utils.TR("activity_receved");Utils.TR("server_version");Utils.TR("encryption");var b=SimpleChat.encryption();var a=$("#server-encryption");if(b!==null){a.removeAttr("data-tr");a.removeClass("red-text");var c="";if(b.protocol==2){c="TLS v1"}else{if(b.protocol==0){c="SSL v3"}}a.html(c+' <a href="'+b.url+'">'+b.CN+'</a> <span id="encryption-cipher">'+b.cipher+"</span>")}else{a.addClass("red-text");a.attr("data-tr","no-encryption");a.text(Utils.tr("no-encryption"))}ServerInfo.server(SimpleChat.feed(Settings.id,FEED_NAME_SERVER,0))},offline:function(){$("#server-peer").text("");ServerInfo.clearInterval()},updateActivity:function(){var a=SimpleChat.traffic();$("#sent").html(SimpleChat.bytesToHuman(a.tx));$("#receved").html(SimpleChat.bytesToHuman(a.rx))},setInterval:function(){ServerInfo.updateActivity();if(ServerInfo.interval===null){ServerInfo.interval=window.setInterval(ServerInfo.updateActivity,1000)}},clearInterval:function(){if(ServerInfo.interval!==null){window.clearInterval(ServerInfo.interval);ServerInfo.interval=null}},adjustWidth:function(){Utils.adjustWidth($("#server-activity .field-row-label"));Utils.adjustWidth($("#server-feed .field-row-label"))},feed:function(a){if(a===false||a.status!==200||a.name!==FEED_NAME_SERVER){return}ServerInfo.server(a.data)},server:function(a){if(a===false){return}$("#server-version").text(a.version)}};$(document).ready(function(){$("body").on("click",".retry-auth",function(a){a.preventDefault();Auth.retry()});$("body").on("click",".btn-unlink",function(a){a.preventDefault();SimpleChat.request(SimpleChat.id(),FEED_METHOD_DELETE,FEED_NAME_HOSTS+"/"+$(this).attr("data-id"),{options:2})})});Pages.onInfo.push(ServerInfo.setInterval);Pages.onInfo.push(ServerInfo.adjustWidth);Pages.onMessages.push(ServerInfo.clearInterval);if(typeof SimpleChat!=="undefined"){SimpleChat.offline.connect(ServerInfo.offline);SimpleChat.online.connect(ServerInfo.online);SimpleChat.retranslated.connect(ServerInfo.adjustWidth);ChatView.feed.connect(ServerInfo.feed)};