!function(){"use strict";function a(a){b.innerHTML="&nbsp;",d.appendChild(e("img",{src:a,"class":"img-responsive",style:"margin: 0 auto"})),c.style.display="none",$(schat.ui.modal.dialog).addClass("image-dialog")}var b=schat.ui.modal.title,c=schat.ui.modal.footer,d=schat.ui.modal.body,e=window.schat.ui.createElement;a.prototype.hidden=function(){$(schat.ui.modal.dialog).removeClass("image-dialog")},schat.ui.ImageDialog=a}(),function(){"use strict";function a(a){this.cont=b("div",{id:a,"class":"cont image-upload panel panel-default"});var c=this.cont.appendChild(b("div",{"class":"panel-heading"}));this.head=c.appendChild(b("span",{"data-tr":"share-upload-images"})),this.cancelBtn=c.appendChild(b("button",{type:"button","class":"btn btn-default btn-cancel btn-xs pull-right","data-tr":"cancel"}));var d=this.cont.appendChild(b("div",{"class":"panel-body"}));this.progress=d.appendChild(b("div",{"class":"progress"})).appendChild(b("div",{"class":"progress-bar"}))}var b=window.schat.ui.createElement;a.prototype.setProgress=function(a,b){this.progress.style.width=Math.floor(100*a/b)+"%",a==b&&this.tr(this.head,"share-please-wait")},a.prototype.setStatus=function(a){var b=200===a?"success":"danger";this.cont.setAttribute("class","cont image-upload panel panel-"+b),this.cancelBtn.setAttribute("class","btn btn-cancel btn-xs pull-right btn-"+b),this.progress.setAttribute("class","progress-bar progress-bar-"+b),200!==a?(this.tr(this.cancelBtn,"share-close"),this.tr(this.head,"share-upload-error")):this.cancelBtn.style.display="none"},a.prototype.tr=function(a,b){a.setAttribute("data-tr",b),a.innerHTML=tr(b)},window.schat.ui.ImageUpload=a}(),function(){"use strict";function a(a){this.cont=b("div",{id:a.OID,"class":"cont image-type panel panel-default","data-mdate":a.MDate,"data-time":a.Date,"data-remover":"image"});var c=600===a.Status?" removed":"",d=this.cont.appendChild(b("div",{"class":"panel-heading"+c}));d.innerHTML=DateTime.template(a.Date,a.Day)+Messages.nameBlock(a.Author);var e=this.cont.appendChild(b("div",{"class":"panel-body"+c}));if(600===a.Status)return e.appendChild(b("img",{"class":"img-thumbnail",src:"qrc:/images/Share/removed-image.png",draggable:!1})),void 0;var f=a.JSON;if(1===f.format&&schat.utils.isArray(f.images))for(var g,h=f.images,i=0;i<h.length;i++)g=e.appendChild(b("a",{href:this.imageUrl(f.link,h[i],"O"),"class":"modal-toggle","data-handler":"image"})),g.appendChild(b("img",{"class":"img-thumbnail",src:this.imageUrl(f.link,h[i],"S")})),g.addEventListener("dragstart",function(a){a.dataTransfer.setData("text/plain",a.target.parentNode.getAttribute("href"))})}var b=window.schat.ui.createElement;a.prototype.imageUrl=function(a,b,c){return a+"/"+c+"/"+b.id.substr(0,2)+"/"+b.id+"."+b.type},schat.ui.ImageMessage=a}(),function(){"use strict";function a(){b.innerHTML="&nbsp;";var a=c.appendChild(d("div",{style:"border: 1px solid #ff0000; height: 69px;"}));a.addEventListener("dragover",function(a){console.log("dragover",a)}),a.addEventListener("drop",function(a){console.log("drop",a)}),a.ondrop=function(){console.log("O_i")}}var b=schat.ui.modal.title;schat.ui.modal.footer;var c=schat.ui.modal.body,d=window.schat.ui.createElement;Share.add=function(){console.log("ADD"),schat.ui.modal.current=new a,$(schat.ui.modal.element).modal()}}(),function(){"use strict";function a(a,b){if(Settings.getId()===a){var c=new schat.ui.ImageUpload(b);Messages.addRawMessage(c.cont),d[b]=c,c.cancelBtn.addEventListener("click",function(){Share.cancel(b),c.cont.parentNode.removeChild(c.cont),delete d[b],alignChat()}),Messages.added.length=0,alignChat()}}function b(a,b,c,e){Settings.getId()===a&&d.hasOwnProperty(b)&&d[b].setProgress(c,e)}function c(a,b,c){Settings.getId()===a&&d.hasOwnProperty(b)&&d[b].setStatus(c)}var d={};Messages.addImageMessage=function(a){var b=a.OID;if(d.hasOwnProperty(b)&&(d[b].cont.parentNode.removeChild(d[b].cont),delete d[b]),null===document.getElementById(b)){var c=new schat.ui.ImageMessage(a);Messages.addHintedRawMessage(c.cont,a.Hint),ChatView.setLastMessage(a.Date)}},Messages.imageRemover=function(a){a.children[0].setAttribute("class","panel-heading removed");var b=a.children[1];b.setAttribute("class","panel-body removed"),b.innerHTML='<img class="img-thumbnail" src="qrc:/images/Share/removed-image.png">'},Modal.create.image=function(a){schat.ui.modal.current=new schat.ui.ImageDialog(a.target.src.replace("/S/","/L/"))},"undefined"!=typeof Share?(Share.uploadStarted.connect(a),Share.uploadProgress.connect(b),Share.uploadStatus.connect(c)):window.Share={}}();