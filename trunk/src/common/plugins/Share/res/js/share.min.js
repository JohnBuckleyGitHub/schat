!function(){"use strict";function a(a){b.innerHTML="&nbsp;",d.appendChild(e("img",{src:a,"class":"img-responsive",style:"margin: 0 auto"})),c.style.display="none",$(schat.ui.modal.dialog).addClass("image-dialog")}var b=schat.ui.modal.title,c=schat.ui.modal.footer,d=schat.ui.modal.body,e=window.schat.ui.createElement;a.prototype.hidden=function(){$(schat.ui.modal.dialog).removeClass("image-dialog")},schat.ui.ImageDialog=a}(),function(){"use strict";function a(a){this.cont=b("div",{id:a,"class":"cont image-upload panel panel-default"});var c=this.cont.appendChild(b("div",{"class":"panel-heading"}));this.head=c.appendChild(b("span",{"data-tr":"share-upload-images"})),this.cancelBtn=c.appendChild(b("button",{type:"button","class":"btn btn-default btn-cancel btn-xs pull-right","data-tr":"cancel"}));var d=this.cont.appendChild(b("div",{"class":"panel-body"}));this.progress=d.appendChild(b("div",{"class":"progress"})).appendChild(b("div",{"class":"progress-bar"}))}var b=window.schat.ui.createElement;a.prototype.setProgress=function(a,b){this.progress.style.width=Math.floor(100*a/b)+"%",a==b&&this.tr(this.head,"share-please-wait")},a.prototype.setStatus=function(a){var b=200===a?"success":"danger";this.cont.setAttribute("class","cont image-upload panel panel-"+b),this.cancelBtn.setAttribute("class","btn btn-cancel btn-xs pull-right btn-"+b),this.progress.setAttribute("class","progress-bar progress-bar-"+b),200!==a?(this.tr(this.cancelBtn,"share-close"),this.tr(this.head,"share-upload-error")):this.cancelBtn.style.display="none"},a.prototype.tr=function(a,b){a.setAttribute("data-tr",b),a.innerHTML=tr(b)},window.schat.ui.ImageUpload=a}(),function(){"use strict";function a(a){this.cont=b("div",{id:a.OID,"class":"cont image-type panel panel-default","data-mdate":a.MDate,"data-time":a.Date,"data-remover":"image"});var c=600===a.Status?" removed":"",d=this.cont.appendChild(b("div",{"class":"panel-heading"+c}));d.innerHTML=DateTime.template(a.Date,a.Day)+Messages.nameBlock(a.Author);var e=this.cont.appendChild(b("div",{"class":"panel-body"+c}));if(600===a.Status)return e.appendChild(b("img",{"class":"img-thumbnail",src:"qrc:/images/Share/removed-image.png",draggable:!1})),void 0;var f=a.JSON;if(1===f.format&&schat.utils.isArray(f.images)){for(var g,h=f.images,i=0;i<h.length;i++)g=e.appendChild(b("a",{href:this.imageUrl(f.link,h[i],"O"),"class":"img-thumbnail modal-toggle",style:"background: url('"+this.imageUrl(f.link,h[i],"S")+"') no-repeat center;","data-handler":"image"})),g.addEventListener("dragstart",this.onDragStart);a.Text.length&&(this.cont.innerHTML+='<div class="panel-footer">'+a.Text+"</div>")}}var b=window.schat.ui.createElement;a.prototype.imageUrl=function(a,b,c){return a+"/"+c+"/"+b.id.substr(0,2)+"/"+b.id+"."+b.type},a.prototype.onDragStart=function(a){a.dataTransfer.setData("text/plain",a.target.href)},schat.ui.ImageMessage=a}(),function(){"use strict";function a(a){ChatView.allowFocus(!0),b.innerHTML=a.title,b.title=a.title,this.id=a.id;var f=d.appendChild(e("form")),g=f.appendChild(e("div",{"class":"form-group"}));g.appendChild(e("label",{"for":"img-desc","data-tr":"share-img-desc"}));var h=g.appendChild(e("input",{type:"text","class":"form-control",id:"img-desc",autofocus:"autofocus"})),i=c.appendChild(e("button",{type:"button","class":"btn btn-primary","data-tr":"share-upload"}));c.appendChild(e("button",{type:"button","class":"btn btn-default","data-dismiss":"modal","data-tr":"cancel"})),f.addEventListener("submit",function(a){a.preventDefault(),i.click()});var j=this;i.addEventListener("click",function(){Share.upload(j.id,h.value),j.id=null,$(schat.ui.modal.element).modal("hide")})}var b=schat.ui.modal.title,c=schat.ui.modal.footer,d=schat.ui.modal.body,e=window.schat.ui.createElement;a.prototype.hidden=function(){ChatView.allowFocus(!1),b.title="",this.id&&Share.cancel(this.id)},Share.add=function(b){$(schat.ui.modal.element).modal("hide"),schat.ui.modal.current=new a(b),$(schat.ui.modal.element).modal()}}(),function(){"use strict";function a(a){"object"==typeof a&&Settings.getId()===a.roomId&&Share.add(a)}function b(a,b){if(Settings.getId()===a){var c=new schat.ui.ImageUpload(b);Messages.addRawMessage(c.cont),e[b]=c,c.cancelBtn.addEventListener("click",function(){Share.cancel(b),c.cont.parentNode.removeChild(c.cont),delete e[b],alignChat()}),Messages.added.length=0,alignChat()}}function c(a,b,c,d){Settings.getId()===a&&e.hasOwnProperty(b)&&e[b].setProgress(c,d)}function d(a,b,c){Settings.getId()===a&&e.hasOwnProperty(b)&&e[b].setStatus(c)}var e={};Messages.addImageMessage=function(a){var b=a.OID;if(e.hasOwnProperty(b)&&(200===a.Status?e[b].cont.parentNode.removeChild(e[b].cont):e[b].setStatus(a.Status),delete e[b]),null===document.getElementById(b)){var c=new schat.ui.ImageMessage(a);Messages.addHintedRawMessage(c.cont,a.Hint),ChatView.setLastMessage(a.Date)}},Messages.imageRemover=function(a){a.children[0].setAttribute("class","panel-heading removed");var b=a.children[1];b.setAttribute("class","panel-body removed"),b.innerHTML='<img class="img-thumbnail" draggable="false" src="qrc:/images/Share/removed-image.png">';var c=a.children[2];c&&a.removeChild(c),alignChat()},Modal.create.image=function(a){schat.ui.modal.current=new schat.ui.ImageDialog(a.target.href.replace("/O/","/L/"))},"undefined"!=typeof Share?(Share.uploadAdded.connect(a),Share.uploadStarted.connect(b),Share.uploadProgress.connect(c),Share.uploadStatus.connect(d)):window.Share={}}();