var ACL_DEFAULT=-1;var ACL_OWNER=15;var ACL_MODERATOR=22;var ACL_READWRITE=6;var ACL_READONLY=4;var ACL_FORBIDDEN=0;var Channels={acl:-1,timeout:{visibility:null,pin:null,acl:null,logging:null},reload:function(){if(Pages.current!=1){return}if(SimpleChat.isOnline()){Loader.spinner.add("loading/info")}Channels.info(SimpleChat.feed(Settings.getId(),FEED_NAME_INFO,4),300)},info:function(b,a){if(b.hasOwnProperty("title")){$("#channel-title-text").text(b.title.text)}if(a!=300){Loader.spinner.remove("loading/info")}Channels.stopSpinner("visibility",a);Channels.stopSpinner("pin",a);Channels.stopSpinner("logging",a)},stopSpinner:function(c,a){if(Channels.timeout[c]===null){return}clearInterval(Channels.timeout[c]);$("#"+c+"-spinner").addClass("hide");if(a!=200&&a!=303){var b=$("#"+c+"-error");b.removeClass("hide");b.attr("title",SimpleChat.statusText(a))}},startSpinner:function(a){$("#"+a+"-error").addClass("hide");Channels.timeout[a]=setTimeout(function(){$("#"+a+"-spinner").removeClass("hide")},400)},feed:function(a){if(a===false){return}if(a.feed==FEED_NAME_INFO&&a.id==Settings.getId()){Channels.info(a.data,a.status)}else{if(a.feed==FEED_NAME_ACL){if(a.type=="reply"){Channels.stopSpinner("acl",a.status)}Channels.online()}}},online:function(){Channels.acl=SimpleChat.match(Settings.getId(),SimpleChat.id());var a=$("#settings-dropdown");if(Channels.acl&9){if(!a.length){$("#channel-buttons").append('<div id="settings-dropdown" class="dropdown pull-right"><a id="channel-settings" data-toggle="dropdown" href="#"></a>'+Channels.menu()+"</div>")}}else{a.remove()}},menu:function(){return'<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu"><li><a href="#" data-tr="channels_title" class="modal-toggle" data-handler="title">'+Utils.tr("channels_title")+'</a></li><li><a href="#" data-tr="channels_options" class="modal-toggle" data-handler="options">'+Utils.tr("channels_options")+"</a></li></ul>"},editAcl:function(b){if(Modal.current!==null){return}$("#modal-header h3").html(Messages.nameTemplate(SimpleChat.channel(b)));var a=$("#modal-body");a.append("<form>");a.append('<form><div id="acl-row" class="row"><label for="acl" data-tr="channels_permissions">'+Utils.tr("channels_permissions")+'</label> <select id="acl" data-user="'+b+'"><option value="-1" data-tr="channels_default">'+Utils.tr("channels_default")+'</option><option value="15" data-tr="channels_owner">'+Utils.tr("channels_owner")+'</option><option value="22" data-tr="channels_moderator">'+Utils.tr("channels_moderator")+'</option><option value="6" data-tr="channels_readwrite">'+Utils.tr("channels_readwrite")+'</option><option value="4" data-tr="channels_readonly">'+Utils.tr("channels_readonly")+'</option><option value="0" data-tr="channels_forbidden">'+Utils.tr("channels_forbidden")+'</option></select> <i id="acl-spinner" class="icon-spinner hide"></i><i id="acl-error" class="icon-error hide"></i></div></form>');$("#acl").val(Channels.value(b));Modal.current="acl";$("#modal").modal()},value:function(c){var b=SimpleChat.match(Settings.getId(),c);if(b&9){return ACL_OWNER}var a=SimpleChat.feed(Settings.getId(),FEED_NAME_ACL,3);if(a===false||!a.hasOwnProperty(c)){return -1}if(b&16){return ACL_MODERATOR}else{if(b==ACL_READWRITE||b==ACL_READONLY||b==ACL_FORBIDDEN){return b}}return -1},setTitle:function(a){a.preventDefault();var b=$("#title-edit").val();$("#modal").modal("hide");if($("#channel-title-text").text()!=b){SimpleChat.request(Settings.getId(),FEED_METHOD_POST,INFO_FEED_TITLE_REQ,{value:b,options:7})}},setVisibility:function(a){var b=$(this).find("option:selected").attr("value");SimpleChat.request(Settings.getId(),FEED_METHOD_POST,INFO_FEED_VISIBILITY_REQ,{value:b,options:7});Channels.startSpinner("visibility")},pinChannel:function(a){SimpleChat.request(Settings.getId(),FEED_METHOD_POST,INFO_FEED_PINNED_REQ,{value:$(this).is(":checked"),options:7});Channels.startSpinner("pin")},logging:function(a){SimpleChat.request(Settings.getId(),FEED_METHOD_POST,INFO_FEED_LOGGING_REQ,{value:$(this).is(":checked"),options:7});Channels.startSpinner("logging")},setAcl:function(b){var c=$(this).find("option:selected").attr("value");var a=$(this).attr("data-user");var d=Settings.getId();if(c==ACL_OWNER){SimpleChat.request(d,FEED_METHOD_POST,ACL_FEED_HEAD_OWNER_REQ,{value:a,options:6})}else{if(c==ACL_DEFAULT){SimpleChat.request(d,FEED_METHOD_DELETE,ACL_FEED_HEAD_OTHER_REQ+"/"+a,{options:6})}else{SimpleChat.request(d,FEED_METHOD_POST,ACL_FEED_HEAD_OTHER_REQ+"/"+a,{value:c,options:6})}}Channels.startSpinner("acl")}};Modal.create.title=function(b){ChatView.allowFocus(true);var a=$("#modal-header h3");a.text(b.target.innerText);a.attr("data-tr","channels_title");$("#modal-body").append('<form id="title-form"><div id="title-group" class="control-group"><input id="title-edit" type="text" maxlength="200"><button id="title-ok" type="submit" class="btn" data-tr="ok">'+Utils.tr("ok")+"</button></div></form>");$("#title-edit").val($("#channel-title-text").text())};Modal.shown.title=function(){$("#title-edit").focus()};Modal.hidden.title=function(){ChatView.allowFocus(false)};Modal.create.options=function(d){var c=$("#modal-header h3");c.text(d.target.innerText);c.attr("data-tr","channels_options");var e=SimpleChat.feed(Settings.getId(),FEED_NAME_INFO,4);if(e!==false){var b=e.visibility||0}var a=$("#modal-body");a.append("<form>");a.append('<div id="visibility-row" class="row"><label for="visibility" data-tr="channels_visibility">'+Utils.tr("channels_visibility")+'</label> <select id="visibility"><option value="0"  data-tr="channels_default">'+Utils.tr("channels_default")+'</option><option value="1"  '+(b>0?"selected":"")+' data-tr="channels_always_visible">'+Utils.tr("channels_always_visible")+'</option><option value="-1" '+(b<0?"selected":"")+' data-tr="channels_hidden">'+Utils.tr("channels_hidden")+'</option></select> <i id="visibility-spinner" class="icon-spinner hide"></i><i id="visibility-error" class="icon-error hide"></i></div>');a.append('<div id="logging-row" class="row"><input id="logging" type="checkbox" '+(e[INFO_FEED_LOGGING_KEY]===false?"":"checked")+'> <label for="logging" data-tr="channels_logging">'+Utils.tr("channels_logging")+'</label> <i id="logging-spinner" class="icon-spinner hide"></i><i id="logging-error" class="icon-error hide"></i></div>');if(SimpleChat.match(SimpleChat.serverId(),SimpleChat.id())&9){a.append('<div id="pin-row" class="row"><input id="pin" type="checkbox" '+(e.pinned==true?"checked":"")+'> <label for="pin" data-tr="channels_pin">'+Utils.tr("channels_pin")+'</label> <i id="pin-spinner" class="icon-spinner hide"></i><i id="pin-error" class="icon-error hide"></i></div>')}a.append("</form>")};Modal.hidden.options=function(){clearTimeout(Channels.timeout.visibility);clearTimeout(Channels.timeout.pin)};$(document).ready(function(){$("#page-header").append('<div id="channel-title"><div id="channel-title-text"></div></div>');var a=$("#modal-body");a.on("click.title","#title-ok",Channels.setTitle);a.on("change.visibility","#visibility",Channels.setVisibility);a.on("change.pinned","#pin",Channels.pinChannel);a.on("change.logging","#logging",Channels.logging);a.on("change.acl","#acl",Channels.setAcl);Channels.online()});Pages.onInfo.push(Channels.reload);if(typeof ChatView!=="undefined"){ChatView.reload.connect(Channels.reload);ChatView.feed.connect(Channels.feed)}if(typeof SimpleChat!=="undefined"){SimpleChat.online.connect(Channels.online)};