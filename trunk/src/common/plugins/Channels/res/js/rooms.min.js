+function(a){"use strict";var b=function(b,c){this.options=c,this.$element=a(b),this.$backdrop=this.isShown=null,this.options.remote&&this.$element.load(this.options.remote)};b.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},b.prototype.toggle=function(a){return this[this.isShown?"hide":"show"](a)},b.prototype.show=function(b){var c=this,d=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(d),this.isShown||d.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.$element.on("click.dismiss.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.backdrop(function(){var d=a.support.transition&&c.$element.hasClass("fade");c.$element.parent().length||c.$element.appendTo(document.body),c.$element.show(),d&&c.$element[0].offsetWidth,c.$element.addClass("in").attr("aria-hidden",!1),c.enforceFocus();var e=a.Event("shown.bs.modal",{relatedTarget:b});d?c.$element.find(".modal-dialog").one(a.support.transition.end,function(){c.$element.focus().trigger(e)}).emulateTransitionEnd(300):c.$element.focus().trigger(e)}))},b.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one(a.support.transition.end,a.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},b.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.focus()},this))},b.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},b.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.removeBackdrop(),a.$element.trigger("hidden.bs.modal")})},b.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},b.prototype.backdrop=function(b){var c=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var d=a.support.transition&&c;if(this.$backdrop=a('<div class="modal-backdrop '+c+'" />').appendTo(document.body),this.$element.on("click.dismiss.modal",a.proxy(function(a){a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),d&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;d?this.$backdrop.one(a.support.transition.end,b).emulateTransitionEnd(150):b()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(a.support.transition.end,b).emulateTransitionEnd(150):b()):b&&b()};var c=a.fn.modal;a.fn.modal=function(c,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},b.DEFAULTS,e.data(),"object"==typeof c&&c);f||e.data("bs.modal",f=new b(this,g)),"string"==typeof c?f[c](d):g.show&&f.show(d)})},a.fn.modal.Constructor=b,a.fn.modal.noConflict=function(){return a.fn.modal=c,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(b){var c=a(this),d=c.attr("href"),e=a(c.attr("data-target")||d&&d.replace(/.*(?=#[^\s]+$)/,"")),f=e.data("modal")?"toggle":a.extend({remote:!/#/.test(d)&&d},e.data(),c.data());b.preventDefault(),e.modal(f,this).one("hide",function(){c.is(":visible")&&c.focus()})}),a(document).on("show.bs.modal",".modal",function(){a(document.body).addClass("modal-open")}).on("hidden.bs.modal",".modal",function(){a(document.body).removeClass("modal-open")})}(window.jQuery),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(){var b=c(this),g=f.settings;return isNaN(b.datetime)||(0===g.cutoff||e(b.datetime)<g.cutoff)&&a(this).html(d(b.datetime)),this}function c(b){if(b=a(b),!b.data("timeago")){b.data("timeago",{datetime:f.datetime(b)});var c=a.trim(b.text());f.settings.localeTitle?b.attr("title",b.data("timeago").datetime.toLocaleString()):!(c.length>0)||f.isTime(b)&&b.attr("title")||b.attr("title",c)}return b.data("timeago")}function d(a){return f.inWords(e(a))}function e(a){return(new Date).getTime()-a.getTime()}a.timeago=function(b){return b instanceof Date?d(b):"string"==typeof b?d(a.timeago.parse(b)):"number"==typeof b?d(new Date(b)):d(a.timeago.datetime(b))};var f=a.timeago;a.extend(a.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(b){function c(c,e){var f=a.isFunction(c)?c(e,b):c,g=d.numbers&&d.numbers[e]||e;return f.replace(/%d/i,g)}var d=tr("timeago"),e=d.prefixAgo,f=d.suffixAgo;this.settings.allowFuture&&0>b&&(e=d.prefixFromNow,f=d.suffixFromNow);var g=Math.abs(b)/1e3,h=g/60,i=h/60,j=i/24,k=j/365,l=45>g&&c(d.seconds,Math.round(g))||90>g&&c(d.minute,1)||45>h&&c(d.minutes,Math.round(h))||90>h&&c(d.hour,1)||24>i&&c(d.hours,Math.round(i))||42>i&&c(d.day,1)||30>j&&c(d.days,Math.round(j))||45>j&&c(d.month,1)||365>j&&c(d.months,Math.round(j/30))||1.5>k&&c(d.year,1)||c(d.years,Math.round(k)),m=d.wordSeparator||"";return void 0===d.wordSeparator&&(m=" "),a.trim([e,l,f].join(m))},datetime:function(b){return new Date(parseInt(a(b).attr("data-date"),10))},isTime:function(b){return"time"===a(b).get(0).tagName.toLowerCase()}});var g={init:function(){var c=a.proxy(b,this);c();var d=f.settings;d.refreshMillis>0&&(this._timeagoInterval=setInterval(c,d.refreshMillis))},update:function(c){a(this).data("timeago",{datetime:f.parse(c)}),b.apply(this)},updateFromDOM:function(){a(this).data("timeago",{datetime:f.parse(f.isTime(this)?a(this).attr("datetime"):a(this).attr("title"))}),b.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};a.fn.timeago=function(a,b){var c=a?g[a]:g.init;if(!c)throw new Error("Unknown function name '"+a+"' for timeago");return this.each(function(){c.call(this,b)}),this}}),function(){"use strict";window.schat={net:{},ui:{},utils:{},lang:{},page:""}}(),function(){"use strict";var a=window.schat.utils;a.isFunction=function(a){return"function"==typeof a},a.isArray=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)},a.randomId=function(){var a=new Array(16);return uuid.v4(null,a,0),base32.encode(a)},a.format=function(a,b){return a.replace(/{(\d+)}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})}}(),function(){"use strict";function a(a,b,c,d){var e=0,f=0,g=!1;("undefined"==typeof b||null===b)&&(b=2),a=a.toString(),d!==!1&&(a=a.replace(/&/g,"&amp;")),a=a.replace(/</g,"&lt;").replace(/>/g,"&gt;");var h={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(0===b&&(g=!0),"number"!=typeof b){for(b=[].concat(b),f=0;f<b.length;f++)0===h[b[f]]?g=!0:h[b[f]]&&(e|=h[b[f]]);b=e}return b&h.ENT_HTML_QUOTE_SINGLE&&(a=a.replace(/'/g,"&#039;")),g||(a=a.replace(/"/g,"&quot;")),a}schat.utils.encode=a}(),function(){"use strict";function a(a,b,c,d){var e=a%10;return 1==e&&(1==a||a>20)?b:e>1&&5>e&&(a>20||10>a)?c:d}function b(a,b){if("timeago"===a){var c=SimpleChat.translate("lang");return e[e.hasOwnProperty(c)?c:"en"]}return SimpleChat.translate(a,b)}function c(a){$('[data-tr="'+a+'"]').html(b(a))}function d(){$("[data-tr]").each(function(){c($(this).attr("data-tr"))})}var e={en:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"<b>%d</b> minutes",hour:"about an hour",hours:"about <b>%d</b> hours",day:"a day",days:"<b>%d</b> days",month:"about a month",months:"<b>%d</b> months",year:"about a year",years:"<b>%d</b> years",wordSeparator:" ",numbers:[]},ru:{prefixAgo:null,prefixFromNow:"через",suffixAgo:"назад",suffixFromNow:null,seconds:"меньше минуты",minute:"минуту",minutes:function(b){return a(b,"<b>%d<b/> минуту","<b>%d</b> минуты","<b>%d</b> минут")},hour:"час",hours:function(b){return a(b,"<b>%d</b> час","<b>%d</b> часа","<b>%d</b> часов")},day:"день",days:function(b){return a(b,"<b>%d</b> день","<b>%d</b> дня","<b>%d</b> дней")},month:"месяц",months:function(b){return a(b,"<b>%d</b> месяц","<b>%d</b> месяца","<b>%d</b> месяцев")},year:"год",years:function(b){return a(b,"<b>%d</b> год","<b>%d</b> года","<b>%d</b> лет")}}};"undefined"!=typeof SimpleChat&&SimpleChat.retranslated.connect(function(){d()}),window.tr=b,window.TR=c,schat.lang.retranslate=d,window.Utils=window.Utils||{},window.Utils.tr=b,window.Utils.TR=c,window.Utils.retranslate=d}(),function(){"use strict";window.schat.ui.main=document.getElementById("main"),window.schat.ui.createElement=function(a,b,c){var d=document.createElement(a);for(var e in b)b.hasOwnProperty(e)&&d.setAttribute(e,b[e]);return"string"==typeof c?d.innerHTML=c:"object"==typeof c&&c.hasOwnProperty("text")&&(d.textContent=c.text),b&&b.hasOwnProperty("data-tr")&&(d.innerHTML=tr(b["data-tr"])),d}}(),function(){"use strict";var a=window.schat.ui.createElement,b=document.getElementById("modal"),c=a("div",{"class":"modal-dialog"}),d=c.appendChild(a("div",{"class":"modal-content"})),e=d.appendChild(a("div",{"class":"modal-header"}));e.appendChild(a("button",{"class":"close","data-dismiss":"modal","aria-hidden":"true"},"&times;"));var f=e.appendChild(a("h4",{"class":"modal-title"})),g=d.appendChild(a("div",{"class":"modal-body"})),h=d.appendChild(a("div",{"class":"modal-footer"}));b.appendChild(c),schat.ui.modal={element:b,header:e,title:f,body:g,footer:h,current:null,dialog:c},$(document).ready(function(){$(b).on("hidden.bs.modal",function(){if(schat.ui.modal.current)try{schat.ui.modal.current.hidden()}catch(a){}f.textContent="",g.textContent="",h.textContent="",h.style.display="block",schat.ui.modal.current=null})}),$(b).on("shown.bs.modal",function(){if(schat.ui.modal.current)try{schat.ui.modal.current.shown()}catch(a){}})}(),function(){"use strict";function a(){schat.ui.main.textContent="",schat.ui.main.setAttribute("class","panel-main"),this.qt="undefined"!=typeof SimpleChat,this.date={index:0,stats:0};var a=b("div",{"class":"panel panel-default panel-rooms"});this.qt||a.appendChild(b("div",{"class":"panel-heading","data-tr":"common-rooms"})),this.rooms=b("div",{"class":"list-group"}),a.appendChild(this.rooms),schat.ui.main.appendChild(a),a=b("div",{"class":"panel panel-default panel-stats"}),this.qt?a.appendChild(b("div",{"class":"panel-heading","data-tr":"common-stats"})):a.appendChild(b("div",{"class":"panel-heading"},'<a href="/stats" class="internal" data-tr="common-stats">'+tr("common-stats")+"</a>")),this.stats=a.appendChild(b("div",{"class":"panel-body"})),schat.ui.main.appendChild(a)}var b=schat.ui.createElement;a.prototype.setRooms=function(a){this.rooms.textContent="";for(var c=0;c<a.length;c++){var d=a[c][4];this.rooms.appendChild(b("div",{"class":"list-group-item"},'<span class="badge">'+a[c][2]+"</span>"+(2&d?'<i class="schat-icon schat-icon-pin pull-right"></i>':"")+(4&d?'<i class="schat-icon schat-icon-lock pull-right"></i>':"")+'<h5 class="list-group-item-heading">'+this.toUrl(a[c][0],a[c][1],d)+"</h5>"+'<small class="list-group-item-text text-muted">'+(""===a[c][3]?tr("channels-no-title"):schat.utils.encode(a[c][3]))+"</small>"))}},a.prototype.setStats=function(a){a&&(this.stats.innerHTML=schat.utils.format(tr("stats-stats"),[tr("stats-users",a.users[0]),tr("stats-rooms",a.rooms[0]),a.users[1],a.users[2]]),$(".timeago").timeago())},a.prototype.toUrl=function(a,b){return'<a class="internal" href="/talk/'+a+'">'+schat.utils.encode(b)+"</a>"},window.schat.ui.MainWidget=a}(),function(){"use strict";function a(){this.serverName=document.getElementById("server-name"),this.joinName=document.getElementById("join-name"),this.joinBtn=document.getElementById("join"),this.createBtn=document.getElementById("create")}a.prototype.setName=function(a){this.serverName.textContent=a},window.schat.ui.RoomsNavbar=a}(),function(){"use strict";function a(){b.textContent=tr("channels-create-title"),b.setAttribute("data-tr","channels-create-title"),d.innerHTML='<div class="form-horizontal"><div id="name-group" class="form-group"><label data-tr="channels-name-label" for="create-name" class="col-sm-3 control-label">'+tr("channels-name-label")+"</label>"+'<div class="col-sm-9">'+'<input type="text" class="form-control" id="create-name" maxlength="64" autofocus="autofocus">'+'<div id="name-alert" class="alert alert-danger"></div>'+"</div>"+"</div>"+'<div class="form-group">'+'<div class="col-sm-offset-3 col-sm-9">'+'<div class="checkbox">'+'<label><input id="access-checkbox" type="checkbox"> <span data-tr="channels-access-checkbox">'+tr("channels-access-checkbox")+"</span></label>"+"</div>"+"</div>"+"</div>"+"</div>",this.createBtn=c.appendChild(e("button",{type:"button","class":"btn btn-primary","data-tr":"channels-create"})),c.appendChild(e("button",{type:"button","class":"btn btn-default","data-dismiss":"modal","data-tr":"channels-cancel"})),this.nameEdit=document.getElementById("create-name"),this.aclCheckbox=document.getElementById("access-checkbox"),this.nameGroup=document.getElementById("name-group"),this.nameAlert=document.getElementById("name-alert");var a=this;$(this.nameEdit).on("input",function(){a.nameGroup.setAttribute("class","form-group"),a.nameAlert.style.display="none",a.nameAlert.textContent=""}),$(this.nameEdit).keydown(function(b){13==b.keyCode&&a.createBtn.click()})}var b=schat.ui.modal.title,c=schat.ui.modal.footer,d=schat.ui.modal.body,e=window.schat.ui.createElement;a.prototype.setError=function(a){this.nameGroup.setAttribute("class","form-group has-error"),this.nameAlert.style.display="block",this.nameAlert.textContent=tr(a),this.nameEdit.focus()},a.prototype.name=function(){return this.nameEdit.value.replace(/\s{2,}/g," ").trim()},window.schat.ui.RoomCreateDialog=a}(),function(){"use strict";function a(){var a=SimpleChat.channel(SimpleChat.serverId());null!==a&&f.setName.call(f,a.Name),SimpleChat.feed(SimpleChat.serverId(),"list",1),SimpleChat.feed(SimpleChat.serverId(),"stats",1)}function b(a){"list"==a.feed?"body"!=a.type||200!=a.status&&303!=a.status?"reply"==a.type&&"id"==a.path&&c(a.data,a.status):g.setRooms(a.data.channels):"stats"!=a.feed||"body"!=a.type||200!=a.status&&303!=a.status||g.setStats(a.data)}function c(a,b){var c=schat.ui.modal.current;!c instanceof schat.ui.RoomCreateDialog||(403==b?(ChannelsView.create(a.value,c.name(),$(c.aclCheckbox).is(":checked")),$(schat.ui.modal.element).modal("hide")):400==b?c.setError("channels-bad-name"):200==b&&c.setError("channels-already-exists"))}function d(){f.joinName.setAttribute("placeholder",tr("channels-channel-name")),g.setStats(SimpleChat.feed(SimpleChat.serverId(),"stats",3))}function e(){schat.lang.retranslate(),d(),a(),$(f.joinBtn).on("click.join",function(a){a.preventDefault();var b=f.joinName.value;b.length>=3&&(ChannelsView.join(b),f.joinName.value="")}),$("body").on("click.channel",".nick",function(a){a.preventDefault(),ChannelsView.join($(this).attr("id"))}),$(f.createBtn).on("click.create",function(a){a.preventDefault();var b=new schat.ui.RoomCreateDialog;schat.ui.modal.current=b,$(schat.ui.modal.element).modal(),$(b.createBtn).on("click.create",function(a){a.preventDefault();var c=b.name();if(0!=c.length)return c.length<3?(b.setError("channels-bad-name"),void 0):(SimpleChat.request(SimpleChat.serverId(),"get","list/id",{value:c}),void 0)})})}schat.ui.MainWidget.prototype.toUrl=function(a,b,c){return'<a href="'+ChannelsView.toUrl(a,b)+'" class="nick color-'+(4&c?"green":"default")+'" id="'+a+'">'+schat.utils.encode(b)+"</a>"};var f=new schat.ui.RoomsNavbar,g=new schat.ui.MainWidget;"undefined"==typeof ChannelsView?window.ChannelsView={join:function(){},create:function(){},toUrl:function(){return"#"}}:(ChannelsView.feed.connect(function(a){b(a)}),ChannelsView.serverRenamed.connect(function(){f.setName.apply(f,arguments)})),"undefined"!=typeof SimpleChat&&(SimpleChat.online.connect(function(){a()}),SimpleChat.retranslated.connect(function(){d()})),$(document).ready(e)}();