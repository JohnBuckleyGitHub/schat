var SendFileUtils={button:function(a,b){return'<a class="btn btn-small btn-file-'+a+'" data-tr="file-'+a+'" href="chat-sendfile:'+a+"/"+b+'">'+Utils.tr("file-"+a)+"</a>"},setStateTr:function(c,b){var a=$("#"+c+" .file-state");a.html(Utils.tr(b));a.attr("data-tr",b);a.removeClass("file-state-inactive")},setStateText:function(c,b){var a=$("#"+c+" .file-state");a.html(b);a.removeAttr("data-tr");a.removeClass("file-state-inactive")},progress:function(c,b,a){SendFileUtils.setStateText(c,b);$("#"+c+" .file-progress .bar").css("width",a+"%")},setFileIcon:function(c){var a=$("#"+c).data("imageId");try{SendFile.fileIcon(c).assignToHTMLImageElement(document.getElementById(a));$("#"+a).show()}catch(b){$("#"+a).hide()}},updateState:function(f){if(document.getElementById(f)===null){return}var e=SendFile.role(f);var c=SendFile.state(f);var b=$("#"+f+" .file-buttons");if(c!="U"){$("#"+f+" .file-name").removeClass("file-only-name");$("#"+f+" .btn-small").remove();$("#"+f+" .file-progress").hide()}if(c=="W"){if(e){SendFileUtils.setStateText(f,SimpleChat.bytesToHuman(SendFile.size(f)));b.append(SendFileUtils.button("saveas",f))}else{SendFileUtils.setStateTr(f,"file-waiting")}}else{if(c=="c"){SendFileUtils.setStateTr(f,"file-cancelled")}else{if(c=="C"){SendFileUtils.setStateTr(f,"file-connecting");$("#"+f+" .file-name").text(SendFile.fileName(f))}else{if(c=="T"){$("#"+f+" .file-progress").show();var a=SendFile.progressInfo(f);if(a.hasOwnProperty("text")){SendFileUtils.progress(f,a.text,a.percent)}}else{if(c=="F"){if(e){var d=SendFile.fileUrls(f);SendFileUtils.setStateText(f,'<span data-tr="file-received">'+Utils.tr("file-received")+'</span> <a href="'+d.dir+'" data-tr="file-show">'+Utils.tr("file-show")+"</a>");b.append(SendFileUtils.button("open",f));$("#"+f+" .btn-file-open").attr("href",d.file)}else{SendFileUtils.setStateTr(f,"file-sent")}}}}}}if(c=="W"||c=="C"||c=="T"){b.append(SendFileUtils.button("cancel",f))}alignChat()}};Messages.addFileMessage=function(c){if(document.getElementById(c.Id)!==null){return}var b=SimpleChat.randomId();var d=document.createElement("div");d.id=c.Id;d.setAttribute("class","container "+c.Type+"-type");d.setAttribute("data-time",c.Date);var a='<div class="blocks '+c.Direction+'">';a+='<div class="file-sender">'+DateTime.template(c.Date,c.Day)+Messages.nameBlock(c.Author)+"</div>";a+='<div class="file-icon"><img id="'+b+'" src="" width="16" height="16" alt="" /></div>';a+='<div class="file-block"><span class="file-name file-only-name">'+c.File+'</span><br><span class="file-state file-state-inactive">&nbsp;</span></div>';a+='<div class="file-buttons btn-group"></div>';a+='<div class="file-progress"><div class="bar"></div></div><div style="clear:both;"></div>';a+="</div>";d.innerHTML=a;Messages.addHintedRawMessage(d,c.Hint);if(c.WeakId===false){ChatView.setLastMessage(c.Date)}$("#"+c.Id).data("imageId",b);SendFileUtils.setFileIcon(c.Id)};Messages.upgradeFileMessage=function(a){if(document.getElementById(a.InternalId)===null){return}if(document.getElementById(a.Id)===null){$("#"+a.InternalId).attr("id",a.Id);$("#"+a.Id+" .btn-file-cancel").attr("href","chat-sendfile:cancel/"+a.Id)}DateTime.update(a);ChatView.setLastMessage(a.Date)};if(typeof SendFile==="undefined"){SendFile={state:function(a){return"U"},role:function(a){return 1},size:function(a){return 0},fileName:function(a){return""},progressInfo:function(a){return{}},fileUrls:function(a){return{}}}}else{SendFile.progress.connect(SendFileUtils.progress);SendFile.stateChanged.connect(SendFileUtils.updateState)}Messages.onAdd.push(SendFileUtils.updateState);