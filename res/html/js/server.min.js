var Hosts={body:function(a){Hosts.read(a)},feed:function(a){if(1==Pages.current&&a.hasOwnProperty("type")&&a.own===!0&&a.feed===FEED_NAME_HOSTS)try{Hosts[a.type](a.data)}catch(b){}},processSingleHost:function(a,b){var c="#"+a;if($(c).length)$(c).show();else{var d='<tr class="host-row" id="'+a+'">'+'<td class="os-cell">'+'<i class="'+(b.online===!0?"icon-status":"icon-status-offline")+' host-status"></i>'+'<a class="host-os" title="'+htmlspecialchars(b.osName)+'"><i class="icon-os os-'+Pages.os(b.os)+'"></i></a>'+"</td>"+'<td class="host-name">'+htmlspecialchars(b.name)+"</td>"+"<td>"+'<a class="host-info" rel="tooltip" data-original-title="'+Utils.table({version:b.version,last_ip:b.host})+'">'+'<i class="icon-info"></i></a> <span class="last-activity timeago" title="'+b.date+'">'+DateTime.template(b.date,!0)+"</span>"+"</td>"+"<td>"+'<a onclick="" class="btn btn-small btn-unlink" data-tr="unlink" data-id="'+a+'">Unlink</a>'+"</td>"+"</tr>";$("#account-table > tbody").append(d)}},read:function(a){if(a!==!1){$(".host-row").hide();for(var b in a)a.hasOwnProperty(b)&&34==b.length&&Hosts.processSingleHost(b,a[b]);Loader.loadJS("qrc:/js/jquery.timeago."+Utils.tr("lang")+".js",function(){$(".timeago").timeago()}),$("#hosts-content p").show(),$("#hosts-content #fieldset").show(),$(".host-row:hidden").remove(),$("a[rel=tooltip]").tooltip(),Loader.spinner.remove("loading/hosts"),Utils.retranslate()}},reload:function(){if(1==Pages.current){SimpleChat.isOnline()&&Loader.spinner.add("loading/hosts");var a=SimpleChat.channel(Settings.getId());null!==a&&$("#info-content > h1").html(Messages.nameTemplate(a)),Utils.TR("my_computers"),Hosts.read(SimpleChat.feed(FEED_NAME_HOSTS,1))}},progress:!1};Pages.onInfo.push(Hosts.reload);try{ChatView.feed.connect(Hosts.feed),ChatView.reload.connect(Hosts.reload)}catch(e){}var AuthDialog={show:function(){Modal.current="auth",Modal.create.auth(null),$("#modal").modal()},providers:function(){var a=Auth.providers();if(a.hasOwnProperty("order")){for(var b=0;b<a.order.length;b++){var c=a.order[b];a.providers.hasOwnProperty(c)&&AuthDialog.addProvider(c,a.providers[c])}$("#modal-header h3 .icon-spinner").remove(),Utils.adjustWidth($("#providers .btn"))}},addProvider:function(a,b){$("#providers").append('<a class="btn" href="'+b.url+' "><i class="provider-'+a+'"></i> '+b.htmlName+"</a>")},hide:function(){$("#modal").modal("hide")}};Modal.create.auth=function(){$("#modal-header h3 *").remove(),$("#modal-body *").remove(),$("#modal-header h3").append("<span></span>"),$("#modal-header h3").append(' <i class="icon-spinner"></i>'),$("#modal-header h3 span").text(Utils.tr("sign_in_with")),$("#modal-header h3 span").attr("data-tr","sign_in_with"),$("#modal-body").append('<div id="providers"></div>'),Auth.anonymous()&&($("#modal-body").append('<div id="anonymous-auth"><a data-tr="or_anon_connect" href="#">'+Utils.tr("or_anon_connect")+"</a></div>"),$("#anonymous-auth a").on("click",function(a){a.preventDefault(),Auth.open()})),AuthDialog.providers()},Modal.shown.auth=function(){Utils.adjustWidth($("#providers .btn"))},Modal.hidden.auth=function(){Auth.cancel()},"undefined"==typeof Auth?Auth={providers:function(){return{}},cancel:function(){},anonymous:function(){return!0},open:function(){},retry:function(){}}:Auth.providersReady.connect(AuthDialog.providers);var ServerInfo={interval:null,online:function(){Settings.id=SimpleChat.serverId(),$("#server-peer").text(SimpleChat.serverPeer()),1===Pages.current&&ServerInfo.setInterval(),Utils.TR("activity"),Utils.TR("activity_sent"),Utils.TR("activity_receved"),Utils.TR("server_version"),Utils.TR("encryption");var a=SimpleChat.encryption(),b=$("#server-encryption");if(null!==a){b.removeAttr("data-tr"),b.removeClass("red-text");var c="";2==a.protocol?c="TLS v1":0==a.protocol&&(c="SSL v3"),b.html(c+' <a href="'+a.url+'">'+a.CN+'</a> <span id="encryption-cipher">'+a.cipher+"</span>")}else b.addClass("red-text"),b.attr("data-tr","no-encryption"),b.text(Utils.tr("no-encryption"));ServerInfo.server(SimpleChat.feed(Settings.id,FEED_NAME_SERVER,0))},offline:function(){$("#server-peer").text(""),ServerInfo.clearInterval()},updateActivity:function(){var a=SimpleChat.traffic();$("#sent").html(SimpleChat.bytesToHuman(a.tx)),$("#receved").html(SimpleChat.bytesToHuman(a.rx))},setInterval:function(){ServerInfo.updateActivity(),null===ServerInfo.interval&&(ServerInfo.interval=window.setInterval(ServerInfo.updateActivity,1e3))},clearInterval:function(){null!==ServerInfo.interval&&(window.clearInterval(ServerInfo.interval),ServerInfo.interval=null)},adjustWidth:function(){Utils.adjustWidth($("#server-activity .field-row-label")),Utils.adjustWidth($("#server-feed .field-row-label"))},feed:function(a){a!==!1&&200===a.status&&a.name===FEED_NAME_SERVER&&ServerInfo.server(a.data)},server:function(a){a!==!1&&$("#server-version").text(a.version)}};$(document).ready(function(){$("body").on("click",".retry-auth",function(a){a.preventDefault(),Auth.retry()}),$("body").on("click",".btn-unlink",function(a){a.preventDefault(),SimpleChat.request(SimpleChat.id(),FEED_METHOD_DELETE,FEED_NAME_HOSTS+"/"+$(this).attr("data-id"),{options:2})})}),Pages.onInfo.push(ServerInfo.setInterval),Pages.onInfo.push(ServerInfo.adjustWidth),Pages.onMessages.push(ServerInfo.clearInterval),"undefined"!=typeof SimpleChat&&(SimpleChat.offline.connect(ServerInfo.offline),SimpleChat.online.connect(ServerInfo.online),SimpleChat.retranslated.connect(ServerInfo.adjustWidth),ChatView.feed.connect(ServerInfo.feed));