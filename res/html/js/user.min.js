var Profile={addRow:function(b,a){$("#profile-table").append(Utils.row("field-"+b,a))},feed:function(a){if(a.type==="body"&&a.feed===FEED_NAME_PROFILE&&a.id===Settings.getId()){Profile.read(a.data,a.status)}},read:function(d,b){if(!Loader.spinner.prepare(FEED_NAME_PROFILE,b)||d===false){return}if(d.hasOwnProperty("provider")){$("#user-account").html('<a href="'+d.link+'"><i class="provider-'+d.provider+'"></i></a>')}else{Profile.setAnonymous()}$("#profile-table *").remove();var f="field-gender-"+Profile.gender(SimpleChat.channel(Settings.getId()).Gender);Profile.addRow("gender",'<span data-tr="'+f+'">'+Utils.tr(f)+"</span>");var a=SimpleChat.fields();for(var c=0;c<a.length;c++){var j=a[c];if(!d.hasOwnProperty(j)){continue}var g=d[j];if(typeof g==="string"&&g===""){continue}try{Profile.Field[j](j,g)}catch(h){}}Profile.retranslate()},gender:function(a){switch(a){case 0:return"male";case 100:return"female";case 151:return"ghost";case 152:return"bot";default:return"unknown"}},reload:function(){if(Pages.current!=1){return}Utils.TR("profile");Profile.read(SimpleChat.feed(Settings.getId(),FEED_NAME_PROFILE,3),302);SimpleChat.feed(Settings.getId(),FEED_NAME_PROFILE,1);Profile.setStatus()},retranslate:function(){Utils.adjustWidth($("#profile-table .field-row-label"))},Field:{name:function(a,b){Profile.addRow(a,Utils.left(htmlspecialchars(Utils.simplified(b)),128))}},setAnonymous:function(){$("#user-account").html('<span data-tr="anonymous_user">'+Utils.tr("anonymous_user")+"</span>")},updateStatus:function(b,a){if(Settings.id!=b){return}if(Settings.status==a){return}Settings.status=a;$("#user-status-text").attr("data-tr","status_"+a);$("#user-status-text").text(Utils.tr("status_"+a))},setStatus:function(){Profile.updateStatus(Settings.id,SimpleChat.status(Settings.id))},offline:function(){Profile.updateStatus(Settings.id,"Offline")}};var Connections={feed:function(a){if(a.type==="body"&&a.feed===FEED_NAME_USER&&a.id==Settings.getId()){Connections.read(a.data,a.status)}},process:function(c,b){$("#connections").append('<div class="connection-row bottom-line" id="'+c+'"><i title="'+htmlspecialchars(b.osName)+'" class="icon-os os-'+Pages.os(b.os)+'"></i> <a href="#" class="connection-host modal-toggle" data-handler="connection">'+b.host+"</a></div>");$("#"+c+" > .connection-host").data("id",c);for(var a=0;a<UserHooks.process.length;a++){UserHooks.process[a](c,b)}},read:function(d,a){if(!Loader.spinner.prepare(FEED_NAME_USER,a)||d===false){return}$(".connection-row").remove();if(!d.hasOwnProperty("provider")){Profile.setAnonymous()}var c=d.connections;var e=0;for(var b in c){if(c.hasOwnProperty(b)&&b.length==34){e++;Connections.process(b,c[b])}}if(e>0){$("#user-offline").hide()}else{Connections.offline()}},reload:function(){if(Pages.current!=1){return}if(SimpleChat.status(Settings.getId())!="Offline"){Connections.online()}else{Connections.offline()}Utils.retranslate()},offline:function(){var d=SimpleChat.mdate(Settings.getId(),FEED_NAME_USER);var e=$("#user-offline");$(".connection-row").remove();if(d&&SimpleChat.isOnline()){e.removeAttr("data-tr");var c=SimpleChat.channel(Settings.getId()).Gender==100?"was_online_f":"was_online_m";var a='<div id="offline-since"><span data-tr="'+c+'">'+Utils.tr(c)+"</span> ";var b=SimpleChat.feed(Settings.getId(),FEED_NAME_USER,3);if(b!==false&&b.hasOwnProperty("last")){a+='<a href="#" class="modal-toggle timeago" data-handler="connection" title="'+d+'">'+DateTime.template(d,true)+"</a>"}else{a+='<span class="timeago" title="'+d+'">'+DateTime.template(d,true)+"</span>"}e.html(a+"</div>");Connections.retranslate()}else{e.attr("data-tr","user_offline");e.html(Utils.tr("user_offline"))}e.show();Loader.spinner.remove("loading/user");if(!d){SimpleChat.feed(Settings.getId(),FEED_NAME_USER,1)}},online:function(){Connections.read(SimpleChat.feed(Settings.getId(),FEED_NAME_USER,3),302);SimpleChat.feed(Settings.getId(),FEED_NAME_USER,1)},retranslate:function(){Loader.loadJS("qrc:/js/jquery.timeago."+Utils.tr("lang")+".js",function(){$(".timeago").timeago()})}};var UserHooks={process:[],connection:[]};Modal.create.connection=function(g){var a=$("#modal-header h3");a.text(g.target.innerText);var f=SimpleChat.feed(Settings.id,FEED_NAME_USER,3);if(f===false||!f.hasOwnProperty("connections")){return false}var h=$(g.target).data("id");var c=typeof h==="undefined"?f.last:f.connections[h];if(typeof c==="undefined"){return false}var d=$("#modal-body");a.text(c.host);d.append(Utils.row("chat_version",htmlspecialchars(c.version)));d.append(Utils.row("os_name",'<i class="icon-os os-'+Pages.os(c.os)+'"></i> '+htmlspecialchars(c.osName)));for(var b=0;b<UserHooks.connection.length;b++){UserHooks.connection[b](c)}return true};Modal.shown.connection=function(){Utils.adjustWidth($("#modal-body .field-row-label"))};Pages.onInfo.push(Profile.reload);Pages.onInfo.push(Connections.reload);if(typeof ChatView!=="undefined"){ChatView.feed.connect(Profile.feed);ChatView.reload.connect(Profile.reload);SimpleChat.retranslated.connect(Profile.retranslate);SimpleChat.retranslated.connect(Connections.retranslate);SimpleChat.statusChanged.connect(Profile.updateStatus);SimpleChat.offline.connect(Profile.offline);SimpleChat.offline.connect(Connections.offline);SimpleChat.online.connect(Connections.online);ChatView.feed.connect(Connections.feed);ChatView.reload.connect(Connections.reload)};