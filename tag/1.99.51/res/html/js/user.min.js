var Profile={addRow:function(b,a){$("#profile-table").append(Utils.row("field-"+b,a))},body:function(a){Profile.read(a)},feed:function(a){if(!a.hasOwnProperty("type")){return}if(a.feed!=="profile"){return}if(a.id!==Settings.id){return}try{Profile[a.type](a.data)}catch(b){}},read:function(c){if(c===false){return}if(c.hasOwnProperty("provider")){$("#user-account").html('<a href="'+c.link+'"><i class="provider-'+c.provider+'"></i></a>')}else{Profile.setAnonymous()}$("#profile-table *").remove();var d="field-gender-"+Profile.gender(SimpleChat.channel(Settings.getId()).Gender);Profile.addRow("gender",'<span data-tr="'+d+'">'+Utils.tr(d)+"</span>");var a=SimpleChat.fields();for(var b=0;b<a.length;b++){var h=a[b];if(!c.hasOwnProperty(h)){continue}var f=c[h];if(typeof f==="string"&&f===""){continue}try{Profile.Field[h](h,f)}catch(g){}}Profile.retranslate();Loader.spinner.remove("loading/profile")},gender:function(a){switch(a){case 0:return"male";case 100:return"female";case 151:return"ghost";case 152:return"bot";default:return"unknown"}},reload:function(){if(Pages.current!=1){return}if(SimpleChat.isOnline()){Loader.spinner.add("loading/profile")}Utils.TR("profile");Profile.read(SimpleChat.feed(Settings.id,"profile",1));Profile.setStatus()},reply:function(a){if(a.action!=="x-set"){return}Profile.read(SimpleChat.feed(Settings.id,"profile",3))},retranslate:function(){Utils.adjustWidth($("#profile-table .field-row-label"))},Field:{name:function(a,b){Profile.addRow(a,Utils.left(htmlspecialchars(Utils.simplified(b)),128))}},setAnonymous:function(){$("#user-account").html('<span data-tr="anonymous_user">'+Utils.tr("anonymous_user")+"</span>")},updateStatus:function(b,a){if(Settings.id!=b){return}if(Settings.status==a){return}Settings.status=a;$("#user-status-text").attr("data-tr","status_"+a);$("#user-status-text").text(Utils.tr("status_"+a))},setStatus:function(){Profile.updateStatus(Settings.id,SimpleChat.status(Settings.id))},offline:function(){Profile.updateStatus(Settings.id,"Offline")}};var Connections={body:function(a){Connections.read(a)},feed:function(a){if(!a.hasOwnProperty("type")){return}if(a.feed!=="user"){return}if(a.id!==Settings.id){return}try{Connections[a.type](a.data)}catch(b){}},process:function(b,a){var c="#"+b;$("#connections").append('<div class="connection-row bottom-line" id="'+b+'"><i class="icon-os"></i> <a href="#" class="connection-host modal-toggle" data-handler="connection"></a></div>');$(c+" .icon-os").attr("class","icon-os os-"+Pages.os(a.os));$(c+" .icon-os").attr("data-original-title",htmlspecialchars(a.osName));$(c+" > .connection-host").text(a.host);$(c+" > .connection-host").data("id",b)},read:function(d){if(d===false||!d.hasOwnProperty("connections")){return}$(".connection-row").remove();if(!d.hasOwnProperty("provider")){Profile.setAnonymous()}var c=d.connections;var e=0;for(var b in c){if(c.hasOwnProperty(b)&&b.length==34){e++;Connections.process(b,c[b]);for(var a=0;a<UserHooks.process.length;a++){UserHooks.process[a](b,c[b])}}}if(e>0){$("#user-offline").hide();$(".icon-os").tooltip()}else{Connections.offline()}Loader.spinner.remove("loading/connections")},reload:function(){if(Pages.current!=1){return}if(SimpleChat.status(Settings.id)!="Offline"){Connections.online()}else{Connections.offline()}Utils.retranslate()},offline:function(){Utils.TR("user_offline");$("#user-offline").show();$(".connection-row").remove();Loader.spinner.remove("loading/connections")},online:function(){if(SimpleChat.isOnline()){Loader.spinner.add("loading/connections")}Connections.read(SimpleChat.feed(Settings.id,"user",1))}};var UserHooks={process:[],connection:[]};Modal.create.connection=function(f){$("#modal-header h3").text(f.target.innerText);var g=$(f.target).data("id");var d=SimpleChat.feed(Settings.id,"user",3);if(d===false||!d.hasOwnProperty("connections")){return}var b=d.connections[g];var c=$("#modal-body");c.append(Utils.row("chat_version",htmlspecialchars(b.version)));c.append(Utils.row("os_name",'<i class="icon-os os-'+Pages.os(b.os)+'"></i> '+htmlspecialchars(b.osName)));for(var a=0;a<UserHooks.connection.length;a++){UserHooks.connection[a](b)}};Modal.shown.connection=function(){Utils.adjustWidth($("#modal-body .field-row-label"))};Pages.onInfo.push(Profile.reload);Pages.onInfo.push(Connections.reload);if(typeof ChatView!=="undefined"){ChatView.feed.connect(Profile.feed);ChatView.reload.connect(Profile.reload);SimpleChat.retranslated.connect(Profile.retranslate);SimpleChat.statusChanged.connect(Profile.updateStatus);SimpleChat.offline.connect(Profile.offline);SimpleChat.offline.connect(Connections.offline);SimpleChat.online.connect(Connections.online);ChatView.feed.connect(Connections.feed);ChatView.reload.connect(Connections.reload)};