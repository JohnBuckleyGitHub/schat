var ACL_DEFAULT=-1;var ACL_OWNER=15;var ACL_MODERATOR=22;var ACL_READWRITE=6;var ACL_READONLY=4;var ACL_FORBIDDEN=0;var ACL_CHANNEL_READWRITE=502;var ACL_CHANNEL_READONLY=484;var ACL_CHANNEL_FORBIDDEN=448;var Channels={acl:-1,timeout:{visibility:null,acl:null,logging:null},reload:function(){if(Pages.current!=1){return}if(SimpleChat.isOnline()){Loader.spinner.add("loading/info")}Channels.info(SimpleChat.feed(Settings.getId(),FEED_NAME_INFO,4),300)},info:function(b,a){if(b.hasOwnProperty("title")){$("#channel-title-text").text(b.title.text)}if(a!=300){Loader.spinner.remove("loading/info")}Channels.stopSpinner("visibility",a);Channels.stopSpinner("logging",a);Channels.stopSpinner("acl",a)},stopSpinner:function(c,a){if(Channels.timeout[c]===null){return}clearInterval(Channels.timeout[c]);$("#"+c+"-spinner").addClass("hide");if(a!=200&&a!=303){var b=$("#"+c+"-error");b.removeClass("hide");b.text(SimpleChat.statusText(a))}},startSpinner:function(a){$("#"+a+"-error").addClass("hide");Channels.timeout[a]=setTimeout(function(){$("#"+a+"-spinner").removeClass("hide")},400)},feed:function(a){if(a===false){return}if(a.feed==FEED_NAME_INFO&&a.id==Settings.getId()){Channels.info(a.data,a.status)}else{if(a.feed==FEED_NAME_ACL){if(a.type=="reply"){Channels.stopSpinner("acl",a.status)}Channels.online()}}},online:function(){Channels.acl=SimpleChat.match(Settings.getId(),SimpleChat.id());var a=$("#settings-dropdown");if(Channels.acl!=-1&&(Channels.acl&9)){if(!a.length){$("#channel-buttons").append('<div id="settings-dropdown" class="dropdown pull-right"><a id="channel-settings" data-toggle="dropdown" href="#"></a>'+Channels.menu()+"</div>")}}else{a.remove()}},menu:function(){return'<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu"><li><a href="#" data-tr="channels_title" class="modal-toggle" data-handler="title">'+Utils.tr("channels_title")+'</a></li><li><a href="#" data-tr="channels_options" class="modal-toggle" data-handler="options">'+Utils.tr("channels_options")+"</a></li></ul>"},editAcl:function(b){if(Modal.current!==null){return}$("#modal-header h3").html(Messages.nameTemplate(SimpleChat.channel(b)));var a=$("#modal-body");a.append("<form>");a.append('<form><div id="acl-row" class="row"><label for="acl" data-tr="channels_permissions">'+Utils.tr("channels_permissions")+'</label> <select id="acl" data-user="'+b+'" class="btn"><option value="-1" data-tr="channels_default">'+Utils.tr("channels_default")+'</option><option value="15" data-tr="channels_owner">'+Utils.tr("channels_owner")+'</option><option value="22" data-tr="channels_moderator">'+Utils.tr("channels_moderator")+'</option><option value="6" data-tr="channels_readwrite">'+Utils.tr("channels_readwrite")+'</option><option value="4" data-tr="channels_readonly">'+Utils.tr("channels_readonly")+'</option><option value="0" data-tr="channels_forbidden">'+Utils.tr("channels_forbidden")+'</option></select> <i id="acl-spinner" class="icon-spinner hide"></i><div id="acl-error" class="alert alert-error hide"></div></div></form>');$("#acl").val(Channels.value(b));Modal.current="acl";$("#modal").modal()},value:function(c){var b=SimpleChat.match(Settings.getId(),c);if(b&9){return ACL_OWNER}var a=SimpleChat.feed(Settings.getId(),FEED_NAME_ACL,3);if(a===false||!a.hasOwnProperty(c)){return -1}if(b&16){return ACL_MODERATOR}else{if(b==ACL_READWRITE||b==ACL_READONLY||b==ACL_FORBIDDEN){return b}}return -1},setTitle:function(a){a.preventDefault();var b=$("#title-edit").val();$("#modal").modal("hide");if($("#channel-title-text").text()!=b){SimpleChat.request(Settings.getId(),FEED_METHOD_POST,INFO_FEED_TITLE_REQ,{value:b,options:7})}},setAcl:function(b){var c=$(this).find("option:selected").attr("value");var a=$(this).attr("data-user");var d=Settings.getId();if(c==ACL_OWNER){SimpleChat.request(d,FEED_METHOD_POST,ACL_FEED_HEAD_OWNER_REQ,{value:a,options:6})}else{if(c==ACL_DEFAULT){SimpleChat.request(d,FEED_METHOD_DELETE,ACL_FEED_HEAD_OTHER_REQ+"/"+a,{options:6})}else{SimpleChat.request(d,FEED_METHOD_POST,ACL_FEED_HEAD_OTHER_REQ+"/"+a,{value:c,options:6})}}Channels.startSpinner("acl")}};Modal.create.title=function(b){ChatView.allowFocus(true);var a=$("#modal-header h3");a.text(b.target.innerText);a.attr("data-tr","channels_title");$("#modal-body").append('<form id="title-form"><div id="title-group" class="control-group"><input id="title-edit" type="text" maxlength="200"><button id="title-ok" type="submit" class="btn" data-tr="ok">'+Utils.tr("ok")+"</button></div></form>");$("#title-edit").val($("#channel-title-text").text())};Modal.shown.title=function(){$("#title-edit").focus()};Modal.hidden.title=function(){ChatView.allowFocus(false)};var OptionsWindow={load:function(b){var a=$("#modal-header h3");a.text(b.target.innerText);a.attr("data-tr","channels_options");SimpleChat.feed(Settings.getId(),FEED_NAME_INFO,1);$.ajax({url:"channel_options.html",isLocal:true,dataType:"html",success:function(d){$("#modal-body").html(d);$("#channel-options [data-tr]").each(function(){Utils.TR($(this).attr("data-tr"))});var c=OptionsWindow;c.retranslate();c.reload();$("#visibility").on("change",c.setVisibility);$("#permissions").on("change",c.setPermissions);$("#logging").on("change",c.setLogging);$("#pin-button").on("click",c.pin);$("#sudo-button").on("click",c.sudo)}})},reload:function(){var d=SimpleChat.feed(Settings.getId(),FEED_NAME_INFO,3);if(d!==false){var b=d.visibility||0;var a=d.sudo||false}$("#visibility").val(b);$("#visibility-row").toggleClass("pinnable",OptionsWindow.isPinnable(b));var e=SimpleChat.match(Settings.getId(),"");var c=ACL_CHANNEL_READWRITE;if(e==4){c=ACL_CHANNEL_READONLY}else{if(e==0){c=ACL_CHANNEL_FORBIDDEN}}$("#permissions").val(c);$("#permissions-row").toggleClass("strict-access",c!=ACL_CHANNEL_READWRITE);$("#pin-button").toggleClass("active",d[INFO_FEED_PINNED_KEY]==true);$("#sudo-button").toggleClass("active",a!==false);$("#logging").attr("checked",d[INFO_FEED_LOGGING_KEY]!==false)},setVisibility:function(){var a=$(this).val();$("#visibility-row").toggleClass("pinnable",OptionsWindow.isPinnable(a));SimpleChat.request(Settings.getId(),FEED_METHOD_POST,INFO_FEED_VISIBILITY_REQ,{value:a,options:7});Channels.startSpinner("visibility")},setPermissions:function(){var a=$(this).val();SimpleChat.request(Settings.getId(),FEED_METHOD_PUT,ACL_FEED_HEAD_MASK_REQ,{value:a,options:6});$("#permissions-row").toggleClass("strict-access",a!=ACL_CHANNEL_READWRITE);Channels.startSpinner("acl")},setLogging:function(){SimpleChat.request(Settings.getId(),FEED_METHOD_POST,INFO_FEED_LOGGING_REQ,{value:$(this).is(":checked"),options:7});Channels.startSpinner("logging")},pin:function(){$(this).toggleClass("active");SimpleChat.request(Settings.getId(),FEED_METHOD_POST,INFO_FEED_PINNED_REQ,{value:$(this).hasClass("active"),options:7});Channels.startSpinner("visibility")},sudo:function(){$(this).toggleClass("active");SimpleChat.request(Settings.getId(),FEED_METHOD_POST,INFO_FEED_SUDO_REQ,{value:$(this).hasClass("active"),options:7});Channels.startSpinner("acl")},isPinnable:function(a){return(a>=0&&SimpleChat.match(SimpleChat.serverId(),SimpleChat.id())&9)>0},retranslate:function(){if(!$("#channel-options").length){return}Utils.adjustWidth($(".options-label"));Utils.adjustWidth($(".options-select"));$("#visibility").addClass("btn");$("#pin-button").attr("title",Utils.tr("channels_pin"));$("#sudo-button").attr("title",Utils.tr("channels_sudo_invite"))}};Modal.create.options=OptionsWindow.load;Modal.hidden.options=function(){clearTimeout(Channels.timeout.visibility);clearTimeout(Channels.timeout.acl)};$(document).ready(function(){$("#page-header").append('<div id="channel-title"><div id="channel-title-text"></div></div>');var a=$("#modal-body");a.on("click.title","#title-ok",Channels.setTitle);a.on("change.acl","#acl",Channels.setAcl);Channels.online()});Pages.onInfo.push(Channels.reload);if(typeof ChatView!=="undefined"){ChatView.reload.connect(Channels.reload);ChatView.feed.connect(Channels.feed)}if(typeof SimpleChat!=="undefined"){SimpleChat.online.connect(Channels.online);SimpleChat.retranslated.connect(OptionsWindow.retranslate)};