Console.home={load:function(){$.ajax({url:"home.html",isLocal:true,dataType:"html",success:Console.home.loaded})},loaded:function(b){$("#page").html(b);Console.current="home";Utils.retranslate();var a=SimpleChat.channel(SimpleChat.serverId());if(a!==null){Console.setName(a.Name)}$("#nav-logout").on("click.home",Console.home.logout);$("body").on("click.name","#name-ok",Console.home.setServerName);$("#oauth-ok").on("click.oauth-ok",Console.home.setOAuthServer);$(".auth-checkbox").on("click.oauth",Console.home.setAuthMethods);$("#main-channel-block :checkbox").on("click.policy",Console.home.setPolicy);Utils.adjustWidth($("#about-server-block .field-row-label"));Utils.adjustWidth($("#users-online-block .field-row-label"));Console.home.online()},online:function(){Console.home.getFeed(FEED_NAME_SERVER);Console.home.getFeed(FEED_NAME_USERS);var b=SimpleChat.encryption();var a=$("#server-encryption");if(b!==null){a.removeAttr("data-tr");a.removeClass("red-text");var c="";if(b.protocol==2){c="TLS v1"}else{if(b.protocol==0){c="SSL v3"}}a.html('<span class="green-text">'+c+"</span>");var d=b.daysToExpiry;if(d>0&&d<=42){a.append(' <span class="orange-text">'+ConsoleView.expirationText(d)+"</span>")}if(d<=0){a.append(' <span class="red-text" data-tr="console_cert_expired">'+Utils.tr("console_cert_expired")+"</span>")}}else{a.addClass("red-text");a.attr("data-tr","no-encryption");a.text(Utils.tr("no-encryption"))}},getFeed:function(a){Console.feed[a].body(SimpleChat.feed(SimpleChat.serverId(),a,3),SimpleChat.serverId(),300);SimpleChat.feed(SimpleChat.serverId(),a,1)},prepare:function(b,a){if(a==300){Loader.spinner.add("loading/"+b);return true}Loader.spinner.remove("loading/"+b);return a==200},logout:function(a){a.preventDefault();Loader.spinner.add("loading/logout");SimpleChat.request(SimpleChat.serverId(),FEED_METHOD_DELETE,CONSOLE_FEED_ME_REQ)},setServerName:function(a){a.preventDefault();ConsoleView.setName(SimpleChat.serverId(),$("#name-edit").val());$("#modal").modal("hide")},setOAuthServer:function(a){a.preventDefault();$("#oauth-group").removeClass("error");SimpleChat.request(SimpleChat.serverId(),FEED_METHOD_PUT,SERVER_FEED_OAUTH_REQ,{value:$("#oauth-server").val()})},setAuthMethods:function(){var a=[];if($("#anonymous-auth").is(":checked")){a.push("anonymous")}if($("#oauth-auth").is(":checked")){a.push("oauth")}SimpleChat.request(SimpleChat.serverId(),FEED_METHOD_PUT,SERVER_FEED_AUTH_REQ,{value:a})},setPolicy:function(){var a=0;if($("#use-main-channel").is(":checked")){a|=1}if(a&1&&$("#forced-join").is(":checked")){a|=2}if(a&2&&$("#disable-leave").is(":checked")){a|=4}Console.home.showPolicy(a);SimpleChat.request(SimpleChat.serverId(),FEED_METHOD_PUT,SERVER_FEED_POLICY_REQ,{value:a})},showPolicy:function(d){d=d||0;var c=$("#use-main-channel");var b=$("#forced-join");var a=$("#disable-leave");c.attr("checked",!!(d&1));b.attr("checked",!!(d&2));a.attr("checked",!!(d&4));if(d&1){b.parent().show()}else{b.parent().hide()}if(d&1&&d&2){a.parent().show()}else{a.parent().hide()}}};Console.feed.console.del.me=function(a){if(a.status==200){Loader.spinner.add("loading/try");SimpleChat.get(SimpleChat.serverId(),"console/try")}Loader.spinner.remove("loading/logout")};Console.feed.server.body=function(c,d,b){if(!Console.home.prepare(FEED_NAME_SERVER,b)||c===false){return}var a=$("#server-version");a.text(c.version);a.append(' <i class="icon-os os-'+Pages.os(c.os)+'"></i>');$("#oauth-auth").attr("checked",c.auth.indexOf("oauth")!=-1);$("#anonymous-auth").attr("checked",c.auth.indexOf("anonymous")!=-1);$("#oauth-server").val(c.oauth);Console.home.showPolicy(c.policy);$("#auth-block").fadeIn("fast");$("#main-channel-block").fadeIn("fast")};Console.feed.server.put.oauth=function(a){if(a.status!=200&&a.status!=303){$("#oauth-group").addClass("error")}};Console.feed.users.body=function(c,e,a){if(SimpleChat.serverId()!=e||!Console.home.prepare(FEED_NAME_USERS,a)||c===false){return}var b=$("#users-online-now");var d=$("#users-online-peak");b.text(c.count);d.text(c.peak.count);d.append(" "+DateTime.template(c.peak.date,true))};Modal.create.name=function(c){var a=$("#modal-header h3");a.text(Utils.tr("console_server_name"));a.attr("data-tr","console_server_name");$("#modal-body").append('<form id="title-form"><div id="name-group" class="control-group"><input id="name-edit" type="text" maxlength="20" class="input-append"><button id="name-ok" type="submit" class="btn btn-prepend" data-tr="ok">'+Utils.tr("ok")+"</button></div></form>");var b=SimpleChat.channel(SimpleChat.serverId());if(b!==null){$("#name-edit").val(b.Name)}};Modal.shown.name=function(){$("#name-edit").focus()};if(typeof SimpleChat!=="undefined"){SimpleChat.online.connect(Console.home.online)};