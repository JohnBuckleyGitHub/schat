$(document).ready(function(){$(window).resize(function(){alignChat()});var a;$("#topic-wrapper").hover(function(){window.clearTimeout(a);$("#body").removeClass("no-topic-author")},function(){a=window.setTimeout(function(){$("#body").addClass("no-topic-author")},2000)});alignChat()});function alignChat(){var c=window.innerHeight;if(c>0){var b=document.getElementById("Chat");var a=b.offsetHeight;if(c-a>0){b.style.position="relative";b.style.top=(c-a-4)+"px"}else{b.style.position="static"}}document.body.scrollTop=document.body.offsetHeight}function addMessage(b){var a=JSON.parse(b);if(a.Type=="channel"){addChannelMessage(a)}else{if(a.Type=="service"||a.Type=="info"){addServiceMessage(a)}}}function addRawMessage(a){$("#Chat").append(a);alignChat()}function addChannelMessage(b){if($("#"+b.Id).length){updateChannelMessage(b);return}var a='<div class="container '+b.Type+'-type" id="'+b.Id+'">';a+='<div class="blocks ';a+=b.Direction;if(b.Status!==undefined){a+=" "+b.Status}if(b.Command=="me"){a+=" me-action"}a+='">';a+=dateTemplate(b.Date,b.Day);a+=nameTemplate(b);a+='<span class="msg-body-block">'+b.Text+"</span>";a+="</div>";a+="</div>";addRawMessage(a)}function addServiceMessage(b){var a='<div class="container '+b.Type+'-type" id="'+b.Id+'">';a+='<div class="blocks ';if(b.Extra!==undefined){a+=b.Extra}a+='">';a+=dateTemplate(b.Date,false);a+=nameTemplate(b);a+='<span class="msg-body-block">'+b.Text+"</span>";a+="</div>";a+="</div>";addRawMessage(a)}function updateChannelMessage(c){var d="#"+c.Id+" > div.blocks";var b=c.Direction;if(c.Status!==undefined){b+=" "+c.Status}if(c.Command=="me"){b+=" me-action"}$(d).attr("class","blocks "+b);if(c.Date>0){var a=new Date(c.Date);if(c.Day===true){$(d+" > .date-time-block > .day").text(dateDay(a))}$(d+" > .date-time-block > .time").text(dateTime(a));$(d+" > .date-time-block > .seconds").text(dateSeconds(a))}}function dateTemplate(d,a){var c="";if(d>0){var b=new Date(d);c+='<span class="date-time-block">';if(a===true){c+='<span class="day">'+dateDay(b)+"</span> "}c+='<span class="time">'+dateTime(b)+"</span>";c+='<span class="seconds">'+dateSeconds(b)+"</span> ";c+="</span>"}return c}function dateDay(a){return datePad(a.getDate())+":"+datePad(a.getMonth()+1)+":"+a.getFullYear()}function dateTime(a){return datePad(a.getHours())+":"+datePad(a.getMinutes())}function dateSeconds(a){return":"+datePad(a.getSeconds())}function datePad(a){return a<10?"0"+a:a}function nameTemplate(b){var a="";if(b.Author===undefined){return a}a+='<span class="nick-block"><a class="nick ';a+=b.Author.Id+'" href="';a+=b.Author.Url+'">';a+=b.Author.Name;a+="</a></span> ";return a}function updateChannelName(d){var c=JSON.parse(d);var b=$("a."+c.Id);b.attr("href",c.Url);b.html(c.Name)}function showSeconds(a){if(a){$("#body").removeClass("no-seconds")}else{$("#body").addClass("no-seconds")}}function showService(a){if(a){$("#body").removeClass("no-service")}else{$("#body").addClass("no-service")}alignChat()}function showTopic(a){if(a){$("#topic-wrapper").show()}else{$("#topic-wrapper").hide()}}function rebindButtonHandlers(){$("button").unbind("click",handleButton);$("button").bind("click",handleButton)}function handleButton(){var a=$(event.target);var c=a.attr("id").split(";");var f=c[0];var b=c[1];if(b=="yes"||b=="no"){$("#"+f).fadeOut("fast",function(){alignChat()})}try{SimpleChat.click(f,b)}catch(d){}}function setTopic(a){$("#topic-wrapper").html(a);if(a===""){$("#topic-wrapper").hide()}else{$("#topic-wrapper").show()}}function updateUserNick(e,d,b){var c=$("a."+e);c.attr("href",d);c.html(b)};