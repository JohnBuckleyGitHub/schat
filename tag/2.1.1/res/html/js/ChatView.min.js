var FEED_METHOD_GET="get";var FEED_METHOD_PUT="put";var FEED_METHOD_POST="post";var FEED_METHOD_DELETE="delete";var FEED_NAME_ACL="acl";var FEED_NAME_CONSOLE="console";var FEED_NAME_HOSTS="hosts";var FEED_NAME_INFO="info";var FEED_NAME_LIST="list";var FEED_NAME_MESSAGES="messages";var FEED_NAME_PROFILE="profile";var FEED_NAME_SERVER="server";var FEED_NAME_USER="user";var FEED_NAME_USERS="users";var SERVER_FEED_AUTH_KEY="auth";var SERVER_FEED_AUTH_REQ="server/auth";var SERVER_FEED_POLICY_KEY="policy";var SERVER_FEED_POLICY_REQ="server/policy";var SERVER_FEED_OAUTH_KEY="oauth";var SERVER_FEED_OAUTH_REQ="server/oauth";var CONSOLE_FEED_ME_KEY="me";var CONSOLE_FEED_ME_REQ="console/me";var INFO_FEED_LOGGING_KEY="logging";var INFO_FEED_LOGGING_REQ="info/logging";var INFO_FEED_PINNED_KEY="pinned";var INFO_FEED_PINNED_REQ="info/pinned";var INFO_FEED_SUDO_REQ="info/sudo";var INFO_FEED_TITLE_REQ="info/title";var INFO_FEED_VISIBILITY_REQ="info/visibility";var ACL_FEED_HEAD_OTHER_REQ="acl/head/other";var ACL_FEED_HEAD_OWNER_REQ="acl/head/owner";var ACL_FEED_HEAD_MASK_REQ="acl/head/mask";var LIST_FEED_ID_REQ="list/id";var Settings={id:"",status:"",scroll:false,scrollTo:null,autoscroll:SimpleChat.value("AutoScroll"),getId:function(){if(Settings.id==""){Settings.id=ChatView.getId()}return Settings.id},changed:function(a,b){if(a=="AutoScroll"){Settings.autoscroll=b;if(b===true){alignChat()}}}};var Utils={left:function(a,b){if(typeof a!=="string"){return""}if(a.length<b){return a}return a.slice(0,b)},retranslate:function(){$("[data-tr]").each(function(){Utils.TR($(this).attr("data-tr"))})},simplified:function(a){return $.trim(a.replace(/\s+/gi," "))},table:function(c){var b="<table><tbody>";for(var a in c){if(c.hasOwnProperty(a)){b+="<tr><td>"+Utils.tr(a)+"</td><td>"+c[a]+"</td></tr>"}}b+="</table></tbody>";return b},tr:function(a){return SimpleChat.translate(a)},TR:function(a){$("[data-tr='"+a+"']").html(Utils.tr(a))},row:function(b,c){if(typeof c!=="string"||c===""){return""}var a='<div class="field-row field-'+b+'">';a+='<span class="field-row-label"><span data-tr="'+b+'">'+Utils.tr(b)+"</span>:</span> ";a+='<span class="field-row-value">'+c+"</span>";return a},adjustWidth:function(c){if(!c.length||c.width()<1||!c.is(":visible")){return}c.css("width","");var a=0;var b=0;c.each(function(){b=$(this).width();if(b>a){a=b}});c.width(a+4)}};var Pages={current:0,onInfo:[],onMessages:[],os:function(a){if(a==0||a>79){return"unknown"}if(a>=1&&a<20){return"windows"}if(a>=20&&a<40){return"osx"}if(a==41){return"ubuntu"}if(a==42){return"gentoo"}if(a==43){return"debian"}if(a==44){return"opensuse"}if(a==45){return"fedora"}if(a==79){return"android"}if(a>=40){return"linux"}return"unknown"},setPage:function(b){SimpleChat.setTabPage(Settings.id,b);Pages.current=b;if(b==0){$("#page-switcher-start").hide();$("#page-switcher-end").show();$("#messages").addClass("active");$("#info").removeClass("active");alignChat();for(var a=0;a<Pages.onMessages.length;a++){Pages.onMessages[a]()}}else{if(b==1){$("#page-switcher-start").show();$("#page-switcher-end").hide();$("#messages").removeClass("active");$("#info").addClass("active");for(a=0;a<Pages.onInfo.length;a++){Pages.onInfo[a]()}}}}};Pages.onInfo.push(function(){var a=SimpleChat.channel(Settings.getId());if(a!==null){$("#channel-name").html(Messages.nameTemplate(a))}});var Messages={onAdd:[],onBulkAdd:[],unhandled:[],added:[],add:function(a){Messages.added.push(a)},feed:function(b){if(b.status==200&&b.feed==FEED_NAME_MESSAGES&&b.cmd==FEED_METHOD_DELETE){var d=b.name.split("/",2);if(d.length==2){var a=document.getElementById(d[1]);if(a!==null){try{var f=a.firstChild;f.classList.add("removed");f.children[2].innerHTML='<span class="message-removed" data-tr="message-removed">'+Utils.tr("message-removed")+'</span> <i class="message-trash"></i>'}catch(c){console.log(c)}}}}},setMessageId:function(a,b){if(b.hasOwnProperty("OID")){a.id=b.OID;a.setAttribute("data-mdate",b.MDate)}else{a.id=b.Id}},addChannelMessage:function(c){var a=null;if(c.hasOwnProperty("InternalId")){a=document.getElementById(c.InternalId);if(a!==null){Messages.updateChannelMessage(a,c);return}}if(c.hasOwnProperty("OID")){a=document.getElementById(c.OID)}else{a=document.getElementById(c.Id)}if(a!==null){Messages.updateChannelMessage(a,c);return}var d=document.createElement("div");Messages.setMessageId(d,c);d.setAttribute("class","container "+c.Type+"-type");d.setAttribute("data-time",c.Date);var b='<div class="blocks ';b+=c.Direction;if(c.Status!==undefined){b+=" "+c.Status}if(c.Command=="me"){b+=" me-action"}b+='">';b+=DateTime.template(c.Date,c.Day);b+=Messages.nameBlock(c.Author);b+='<span class="msg-body-block">'+c.Text+"</span>";b+="</div>";d.innerHTML=b;Messages.addHintedRawMessage(d,c.Hint);if(c.hasOwnProperty("Status")&&c.Status=="undelivered"){return}ChatView.setLastMessage(c.Date)},addHintedRawMessage:function(c,b){if(b.Hint=="before"){var a=document.getElementById(b.Id);if(a!==null){a.parentNode.insertBefore(c,a);Messages.add(c.id);return}}Messages.addRawMessage(c,b.Day)},addMessage:function(a){var b=a.Func;if(b==undefined){return}if(!Messages.hasOwnProperty(b)){return}try{if(a.Type!=="unhandled"){Messages.day(a.Hint.Day)}Messages[b](a)}catch(c){console.log(c)}},addMessages:function(f){if(!f.length){return}var c=Messages;var a=Settings.scroll;var b=Settings.scrollTo;Settings.scroll=false;Settings.scrollTo=null;for(var e=0;e<f.length;e++){c.addMessage(f[e])}for(e=0;e<c.added.length;e++){for(var d=0;d<c.onAdd.length;d++){c.onAdd[d](c.added[e])}}for(e=0;e<c.onBulkAdd.length;e++){c.onBulkAdd[e](c.added)}Settings.scroll=a;if(c.added.length){c.added.length=0}else{if(Settings.scrollTo===null){Settings.scrollTo=b}}alignChat();if(Settings.scrollTo!==null){document.getElementById(Settings.scrollTo).scrollIntoView()}},addRawMessage:function(b,a){document.getElementById("Chat").appendChild(b);Messages.add(b.id)},addServiceMessage:function(a){var b=document.createElement("div");b.id=a.Id;b.setAttribute("class","container "+a.Type+"-type");b.innerHTML='<div class="blocks '+(a.Extra!==undefined?a.Extra:"")+'">'+DateTime.template(a.Date,false)+Messages.nameBlock(a.Author)+'<span class="msg-body-block">'+a.Text+"</span></div>";Messages.addRawMessage(b,a.Hint.Day)},addAlertMessage:function(a){var b=document.createElement("div");b.id=a.Id;b.setAttribute("class","container "+a.Type+"-type");b.innerHTML='<div class="blocks '+(a.Extra!==undefined?a.Extra:"")+'"><div class="alert-box"><div class="alert-box-icon"></div><div class="alert-box-body">'+a.Text+'</div><div class="alert-box-buttons"><a class="alert-box-close" href="#" data-id="'+a.Id+'"></a></div></div></div>';Messages.addRawMessage(b,a.Hint.Day)},addUnhandledMessage:function(b){for(var a=0;a<Messages.unhandled.length;a++){Messages.unhandled[a](b)}},nameBlock:function(b){var a=Messages.nameTemplate(b);if(a==""){return a}return'<span class="nick-block">'+a+"</span> "},nameTemplate:function(a){if(a===undefined){return""}return'<a class="nick '+a.Id+" color-"+a.Color+'" href="'+a.Url+'">'+htmlspecialchars(a.Name)+"</a>"},reload:function(){if(Pages.current!=0){return}$(".container").remove();alignChat()},updateChannelMessage:function(a,d){Messages.setMessageId(a,d);var c=d.Direction;if(d.Status!==undefined){c+=" "+d.Status}if(d.Command=="me"){c+=" me-action"}var e=a.firstChild;e.setAttribute("class","blocks "+c);if(d.Date>0&&a.getAttribute("data-time")!=d.Date){var b=new Date(d.Date);e.firstChild.innerHTML='<span class="time">'+DateTime.time(b)+'</span><span class="seconds">'+DateTime.seconds(b)+"</span> ";a.setAttribute("data-time",d.Date);ChatView.setLastMessage(d.Date)}},day:function(a){},rename:function(c){var b=$("a."+c.Id);b.attr("href",c.Url);b.html(htmlspecialchars(c.Name))},recolor:function(c){var b=$("a."+c.Id);b.removeClassRegEx(/^color-/);b.addClass("color-"+c.Color)}};var DateTime={day:function(a){return DateTime.pad(a.getDate())+"."+DateTime.pad(a.getMonth()+1)+"."+a.getFullYear()},dayId:function(a){return a.getFullYear()+"_"+DateTime.pad(a.getMonth()+1)+"_"+DateTime.pad(a.getDate())},pad:function(a){return a<10?"0"+a:a},seconds:function(a){return":"+DateTime.pad(a.getSeconds())},template:function(d,a){if(d>0){var c=new Date(d);var b='<span class="date-time-block">';if(a===true){b+='<span class="day">'+DateTime.day(c)+"</span> "}b+='<span class="time">'+DateTime.time(c)+'</span><span class="seconds">'+DateTime.seconds(c)+"</span> </span>";return b}return""},time:function(a){return DateTime.pad(a.getHours())+":"+DateTime.pad(a.getMinutes())}};var Loader={jsfiles:[],done:function(){ChatView.loadFinished();alignChat()},load:function(b){for(var a=0;a<b.length;a++){Loader.jsfiles.push(b[a])}for(a=0;a<Loader.jsfiles.length;a++){Loader.loadJS(Loader.jsfiles[a])}},loadCSS:function(a){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("href",a);document.getElementsByTagName("head")[0].appendChild(b)},loadJS:function(a,b){$.ajax({url:a,dataType:"script",isLocal:true,success:function(){Loader.remove(a);if(typeof b=="function"){b()}},error:function(){Loader.remove(a)}})},remove:function(b){var a=Loader.jsfiles.indexOf(b);if(a===-1){return}Loader.jsfiles.splice(a,1);if(Loader.jsfiles.length===0){Loader.done()}},spinner:{tasks:[],current:null,add:function(b){if(Loader.spinner.current!==null&&Loader.spinner.current==b){return}var c=b.split("/")[0];Loader.spinner.current=b;$("#loading-text").html(Utils.tr(c));$("#loading-text").attr("data-tr",c);$("#loading-body").fadeIn("fast");var d=Loader.spinner.tasks;var a=d.indexOf(b);if(a!=-1){d.splice(a,1)}d.unshift(b)},remove:function(b){Loader.spinner.current=null;var c=Loader.spinner.tasks;var a=c.indexOf(b);if(a==-1){return}c.splice(a,1);if(a==0){Loader.spinner.current=null;if(c.length){Loader.spinner.add(c[0])}else{$("#loading-body").fadeOut("fast")}}},prepare:function(b,a){if(a==302){Loader.spinner.add("loading/"+b);return true}Loader.spinner.remove("loading/"+b);return a==200||a==300}}};var Modal={current:null,create:{},hidden:{},shown:{},init:function(){var a=$("body");var b=$("#modal");a.on("click.modal",".modal-toggle",function(d){d.preventDefault();var c=$(this).attr("data-handler");if(c!==undefined&&Modal.create.hasOwnProperty(c)){if(Modal.create[c](d)===false){return}Modal.current=c}$("#modal").modal()});b.on("hidden",function(){if(Modal.hidden.hasOwnProperty(Modal.current)){Modal.hidden[Modal.current]()}$("#modal-header h3 *").remove();$("#modal-body *").remove();Modal.current=null});b.on("shown",function(){if(Modal.shown.hasOwnProperty(Modal.current)){Modal.shown[Modal.current]()}});a.on("click",'[data-dismiss="alert"]',function(c){c.preventDefault();$(this).parent().remove();alignChat()})}};$(document).ready(function(){$(window).resize(function(){alignChat()});$("#page-switcher-start").on("click",function(b){Pages.setPage(0)});$("#page-switcher-end").on("click",function(b){Pages.setPage(1)});var a=ChatView.jsfiles();if(a.length===0){Loader.done();return}$("body").on("click",".alert-box-close",function(b){b.preventDefault();$("#"+$(this).attr("data-id")).remove();alignChat()});Modal.init();Loader.load(a)});function alignChat(){if(!Settings.scroll){return}var c=window.innerHeight;if(c>0){var b=document.getElementById("Chat");var a=b.offsetHeight;if(c-a>0){b.style.position="relative";b.style.top=(c-a-4)+"px"}else{b.style.position="static"}}if(Settings.autoscroll){document.body.scrollTop=document.body.offsetHeight}}function showSeconds(a){if(a){$("#body").removeClass("no-seconds")}else{$("#body").addClass("no-seconds")}}function showService(a){if(a){$("#body").removeClass("no-service")}else{$("#body").addClass("no-service")}alignChat()}function htmlspecialchars(c,h,g,b){var e=0,d=0,f=false;if(typeof h==="undefined"||h===null){h=2}if(typeof c!=="string"){return""}c=c.toString();if(b!==false){c=c.replace(/&/g,"&amp;")}c=c.replace(/</g,"&lt;").replace(/>/g,"&gt;");var a={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(h===0){f=true}if(typeof h!=="number"){h=[].concat(h);for(d=0;d<h.length;d++){if(a[h[d]]===0){f=true}else{if(a[h[d]]){e=e|a[h[d]]}}}h=e}if(h&a.ENT_HTML_QUOTE_SINGLE){c=c.replace(/'/g,"&#039;")}if(!f){c=c.replace(/"/g,"&quot;")}return c}(function(a){a.fn.removeClassRegEx=function(f){var e=a(this).attr("class");if(!e||!f){return false}var c=[];e=e.split(" ");for(var d=0,b=e.length;d<b;d++){if(!e[d].match(f)){c.push(e[d])}}a(this).attr("class",c.join(" "))}})(jQuery);if(typeof SimpleChat==="undefined"){SimpleChat={bytesToHuman:function(a){return"0 bytes"},channel:function(a){return"{}"},day:function(a){return a},encryption:function(){return false},feed:function(c,b,a){return false},get:function(c,a,b){},id:function(){return""},isOnline:function(){return true},match:function(b,a){return -1},mdate:function(b,a){return 0},randomId:function(){return""},request:function(d,c,a,b){},serverId:function(){return""},serverPeer:function(){return""},setTabPage:function(b,a){},status:function(a){return"Offline"},statusText:function(a){return""},toBase32:function(a){return""},traffic:function(){return{tx:0,rx:0}},translate:function(a){return a},value:function(a){return null},pinTab:function(a){},aclToInt:function(a){return 6}}}else{SimpleChat.retranslated.connect(Utils.retranslate);SimpleChat.renamed.connect(Messages.rename);SimpleChat.recolored.connect(Messages.recolor);SimpleChat.settingsChanged.connect(Settings.changed)}if(typeof ChatView==="undefined"){ChatView={jsfiles:function(){return[]},loadFinished:function(){},getId:function(){return""},setLastMessage:function(a){},removeDay:function(a){},allowFocus:function(a){}}}else{ChatView.reload.connect(Messages.reload);ChatView.messages.connect(Messages.addMessages);ChatView.feed.connect(Messages.feed)};