var ACL_DEFAULT=-1,ACL_OWNER=15,ACL_MODERATOR=22,ACL_READWRITE=6,ACL_READONLY=4,ACL_FORBIDDEN=0,ACL_CHANNEL_READWRITE=502,ACL_CHANNEL_READONLY=484,ACL_CHANNEL_FORBIDDEN=448,Channels={acl:-1,timeout:{visibility:null,acl:null,logging:null},reload:function(){1==Pages.current&&(SimpleChat.isOnline()&&Loader.spinner.add("loading/info"),Channels.info(SimpleChat.feed(Settings.getId(),FEED_NAME_INFO,4),300))},info:function(a,b){a.hasOwnProperty("title")&&(document.getElementById("channel-title-text").textContent=a.title.text),300!=b&&Loader.spinner.remove("loading/info")},feed:function(a){a!==!1&&(a.feed==FEED_NAME_INFO&&a.id==Settings.getId()?Channels.info(a.data,a.status):a.feed==FEED_NAME_ACL&&Channels.online())},online:function(){Channels.acl=SimpleChat.match(Settings.getId(),SimpleChat.id());var a=$("#settings-dropdown");-1!=Channels.acl&&9&Channels.acl?a.length||$("#channel-buttons").append('<div id="settings-dropdown" class="dropdown pull-right"><a id="channel-settings" data-toggle="dropdown" href="#"></a>'+Channels.menu()+"</div>"):a.remove()},menu:function(){return'<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu"><li><a href="#" data-tr="channels-title" class="modal-toggle" data-handler="title">'+tr("channels-title")+"</a></li>"+'<li><a href="#" data-tr="channels-options" class="modal-toggle" data-handler="options">'+tr("channels-options")+"</a></li>"+"</ul>"},editAcl:function(a){$(schat.ui.modal.element).modal("hide"),schat.ui.modal.current=new schat.ui.RoomAclDialog(a),$(schat.ui.modal.element).modal()}};Modal.create.title=function(){schat.ui.modal.current=new schat.ui.RoomTitleDialog},Modal.create.options=function(){schat.ui.modal.current=new schat.ui.RoomOptionsDialog},$(document).ready(function(){$("#page-header").append('<div id="channel-title"><div id="channel-title-text"></div></div>'),Channels.online()}),Pages.onInfo.push(Channels.reload);try{ChatView.reload.connect(Channels.reload),ChatView.feed.connect(Channels.feed),SimpleChat.online.connect(Channels.online)}catch(e){}!function(){"use strict";function a(){b.textContent=tr("channels-title"),b.setAttribute("data-tr","channels-title"),ChatView.allowFocus(!0);var a=d.appendChild(e("form",{"class":"form-horizontal"}));a.innerHTML='<div class="form-group"><div class="col-sm-12"><input type="text" class="form-control" id="title-edit" maxlength="200" autofocus="autofocus"></div></div>',this.btn=c.appendChild(e("button",{type:"button","class":"btn btn-primary","data-tr":"ok"})),c.appendChild(e("button",{type:"button","class":"btn btn-default","data-dismiss":"modal","data-tr":"cancel"})),this.titleEdit=document.getElementById("title-edit"),this.titleEdit.value=document.getElementById("channel-title-text").textContent;var f=this;a.addEventListener("submit",function(){f.setTitle.apply(f,arguments)}),this.btn.addEventListener("click",function(){f.setTitle.apply(f,arguments)})}var b=schat.ui.modal.title,c=schat.ui.modal.footer,d=schat.ui.modal.body,e=window.schat.ui.createElement;a.prototype.hidden=function(){ChatView.allowFocus(!1)},a.prototype.setTitle=function(a){a.preventDefault();var b=this.titleEdit.value;document.getElementById("channel-title-text").textContent!==b&&SimpleChat.request(Settings.getId(),FEED_METHOD_POST,INFO_FEED_TITLE_REQ,{value:b,options:7}),$(schat.ui.modal.element).modal("hide")},schat.ui.RoomTitleDialog=a}(),function(){"use strict";function a(a){return(a>=0&&9&SimpleChat.match(SimpleChat.serverId(),SimpleChat.id()))>0}function b(){c.textContent=tr("channels-options"),c.setAttribute("data-tr","channels-options"),d.style.display="none";var a=this;SimpleChat.feed(Settings.getId(),FEED_NAME_INFO,1),$.ajax({url:"channel_options.html",isLocal:!0,dataType:"html",success:function(){a.onLoadSuccess.apply(a,arguments)}})}var c=schat.ui.modal.title,d=schat.ui.modal.footer,e=schat.ui.modal.body;window.schat.ui.createElement,b.prototype.onLoadSuccess=function(a){e.innerHTML=a,$("#channel-options [data-tr]").each(function(){TR($(this).attr("data-tr"))}),this.visibility=document.getElementById("visibility"),this.visibilityRow=document.getElementById("visibility-row"),this.permissions=document.getElementById("permissions"),this.permissionsRow=document.getElementById("permissions-row"),this.logging=document.getElementById("logging"),this.images=document.getElementById("images"),this.pinBtn=document.getElementById("pin-button"),this.sudoBtn=document.getElementById("sudo-button"),this.retranslate(),this.reload();var b=this;this.visibility.addEventListener("change",function(){b.setVisibility.apply(b,arguments)}),this.permissions.addEventListener("change",function(){b.setPermissions.apply(b,arguments)}),this.logging.addEventListener("change",this.setLogging),this.images.addEventListener("change",this.setImages),this.pinBtn.addEventListener("click",this.pin),this.sudoBtn.addEventListener("click",this.sudo)},b.prototype.retranslate=function(){Utils.adjustWidth($(".options-label")),Utils.adjustWidth($(".options-select")),this.pinBtn.title=tr("channels-pin"),this.sudoBtn.title=tr("channels-sudo-invite")},b.prototype.reload=function(){var b=SimpleChat.feed(Settings.getId(),FEED_NAME_INFO,3);if(b!==!1)var c=b.visibility||0,d=b.sudo||!1;this.visibility.value=c,$(this.visibilityRow).toggleClass("pinnable",a(c));var e=SimpleChat.match(Settings.getId(),""),f=ACL_CHANNEL_READWRITE;4==e?f=ACL_CHANNEL_READONLY:0==e&&(f=ACL_CHANNEL_FORBIDDEN),this.permissions.value=f,$(this.permissionsRow).toggleClass("strict-access",f!=ACL_CHANNEL_READWRITE),$(this.pinBtn).toggleClass("active",1==b[INFO_FEED_PINNED_KEY]),$(this.sudoBtn).toggleClass("active",d!==!1),$(this.logging).attr("checked",b[INFO_FEED_LOGGING_KEY]!==!1),this.images.checked=b.images!==!1},b.prototype.setVisibility=function(){var b=this.visibility.value;$(this.visibilityRow).toggleClass("pinnable",a(b)),SimpleChat.request(Settings.getId(),FEED_METHOD_POST,INFO_FEED_VISIBILITY_REQ,{value:b,options:7})},b.prototype.setPermissions=function(){var a=this.permissions.value;SimpleChat.request(Settings.getId(),FEED_METHOD_PUT,ACL_FEED_HEAD_MASK_REQ,{value:a,options:6}),$(this.permissionsRow).toggleClass("strict-access",a!=ACL_CHANNEL_READWRITE)},b.prototype.setLogging=function(){SimpleChat.request(Settings.getId(),FEED_METHOD_POST,INFO_FEED_LOGGING_REQ,{value:$(this).is(":checked"),options:7})},b.prototype.setImages=function(){SimpleChat.request(Settings.getId(),FEED_METHOD_POST,"info/images",{value:$(this).is(":checked"),options:7})},b.prototype.pin=function(){var a=$(this);a.toggleClass("active"),SimpleChat.request(Settings.getId(),FEED_METHOD_POST,INFO_FEED_PINNED_REQ,{value:a.hasClass("active"),options:7})},b.prototype.sudo=function(){var a=$(this);a.toggleClass("active"),SimpleChat.request(Settings.getId(),FEED_METHOD_POST,INFO_FEED_SUDO_REQ,{value:a.hasClass("active"),options:7})},schat.ui.RoomOptionsDialog=b;try{SimpleChat.retranslated.connect(function(){var a=schat.ui.modal.current;a instanceof schat.ui.RoomOptionsDialog&&a.retranslate.apply(a)})}catch(f){}}(),function(){"use strict";function a(a){var b=SimpleChat.match(Settings.getId(),a);if(9&b)return ACL_OWNER;var c=SimpleChat.feed(Settings.getId(),FEED_NAME_ACL,3);return c!==!1&&c.hasOwnProperty(a)?16&b?ACL_MODERATOR:b==ACL_READWRITE||b==ACL_READONLY||b==ACL_FORBIDDEN?b:-1:-1}function b(b){c.innerHTML=Messages.nameTemplate(SimpleChat.channel(b)),c.removeAttribute("data-tr"),e.innerHTML='<form><div id="acl-row" class="form-group"><label for="acl" data-tr="channels-permissions" class="options-label control-label">'+tr("channels-permissions")+"</label> "+'<select id="acl" data-user="'+b+'" class="btn btn-default">'+'<option value="-1" data-tr="channels-default">'+tr("channels-default")+"</option>"+'<option value="15" data-tr="channels-owner">'+tr("channels-owner")+"</option>"+'<option value="22" data-tr="channels-moderator">'+tr("channels-moderator")+"</option>"+'<option value="6" data-tr="channels-readwrite">'+tr("channels-readwrite")+"</option>"+'<option value="4" data-tr="channels-readonly">'+tr("channels-readonly")+"</option>"+'<option value="0" data-tr="channels-forbidden">'+tr("channels-forbidden")+"</option>"+"</select> "+'<i id="acl-spinner" class="icon-spinner hide"></i>'+'<div id="acl-error" class="alert alert-error hide"></div>'+"</div>"+"</form>",this.acl=document.getElementById("acl"),this.acl.value=a(b),this.btn=d.appendChild(f("button",{type:"button","class":"btn btn-primary","data-tr":"ok"})),d.appendChild(f("button",{type:"button","class":"btn btn-default","data-dismiss":"modal","data-tr":"cancel"}));var g=this;this.btn.addEventListener("click",function(){g.setAcl.apply(g,arguments)})}var c=schat.ui.modal.title,d=schat.ui.modal.footer,e=schat.ui.modal.body,f=window.schat.ui.createElement;b.prototype.setAcl=function(a){a.preventDefault();var b=this.acl.value,c=this.acl.getAttribute("data-user"),d=Settings.getId();b==ACL_OWNER?SimpleChat.request(d,FEED_METHOD_POST,ACL_FEED_HEAD_OWNER_REQ,{value:c,options:6}):b==ACL_DEFAULT?SimpleChat.request(d,FEED_METHOD_DELETE,ACL_FEED_HEAD_OTHER_REQ+"/"+c,{options:6}):SimpleChat.request(d,FEED_METHOD_POST,ACL_FEED_HEAD_OTHER_REQ+"/"+c,{value:b,options:6}),$(schat.ui.modal.element).modal("hide")},schat.ui.RoomAclDialog=b}();