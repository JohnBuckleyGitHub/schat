var SendFileUtils={button:function(a,b){return'<a class="btn btn-small btn-file-'+a+'" data-tr="file-'+a+'" href="chat-sendfile:'+a+"/"+b+'">'+Utils.tr("file-"+a)+"</a>"},setStateTr:function(c,b){var a=$("#"+c+" .file-state");a.html(Utils.tr(b));a.attr("data-tr",b)},setStateText:function(c,b){var a=$("#"+c+" .file-state");a.html(b);a.removeAttr("data-tr")},cancelled:function(a){SendFileUtils.setStateTr(a,"file-cancelled");$("#"+a+" .file-buttons").remove();$("#"+a+" .file-progress").remove()},accepted:function(b,a){SendFileUtils.setStateTr(b,"file-connecting");$("#"+b+" .file-name").text(a);$("#"+b+" .btn-file-saveas").remove()},progress:function(c,b,a){SendFileUtils.setStateText(c,b);$("#"+c+" .file-progress .bar").css("width",a+"%")},sent:function(a){SendFileUtils.setStateTr(a,"file-sent");$("#"+a+" .file-buttons").remove();$("#"+a+" .file-progress").remove()},received:function(c,a,b){SendFileUtils.setStateText(c,'<span data-tr="file-received">'+Utils.tr("file-received")+'</span> <a href="'+a+'" data-tr="file-show">'+Utils.tr("file-show")+"</a>");$("#"+c+" .file-progress").remove();$("#"+c+" .btn-file-cancel").remove();$("#"+c+" .btn-file-saveas").remove();$("#"+c+" .file-buttons").prepend(SendFileUtils.button("open",c));$("#"+c+" .btn-file-open").attr("href",b);SendFileUtils.setFileIcon(c)},setFileIcon:function(c){var a=$("#"+c).data("imageId");try{SendFile.fileIcon(c).assignToHTMLImageElement(document.getElementById(a));$("#"+a).show()}catch(b){$("#"+a).hide()}}};Messages.addFileMessage=function(c){var d=c.Id;var b=SimpleChat.randomId();var a='<div class="container '+c.Type+'-type" id="'+c.Id+'">';a+='<div class="blocks '+c.Direction+'">';a+='<div class="file-sender">'+DateTime.template(c.Date,c.Day)+Messages.nameBlock(c.Author)+"</div>";a+='<div class="file-icon"><img id="'+b+'" src="" width="16" height="16" alt="" /></div>';a+='<div class="file-block"><span class="file-name">'+c.File+'</span><br><span class="file-state">&nbsp;</span></div>';a+='<div class="file-buttons btn-group">'+SendFileUtils.button("cancel",d)+"</div>";a+='<div class="file-progress"><div class="bar"></div></div><div style="clear:both;"></div>';a+="</div></div>";Messages.addHintedRawMessage(a,c.Hint,d);$("#"+d).data("imageId",b);SendFileUtils.setFileIcon(d);if(c.Direction==="outgoing"){SendFileUtils.setStateTr(d,"file-waiting")}else{SendFileUtils.setStateText(d,SimpleChat.bytesToHuman(c.Size));$("#"+d+" .file-buttons").prepend(SendFileUtils.button("saveas",d))}};if(typeof SendFile==="undefined"){SendFile={}}else{SendFile.cancelled.connect(SendFileUtils.cancelled);SendFile.accepted.connect(SendFileUtils.accepted);SendFile.progress.connect(SendFileUtils.progress);SendFile.sent.connect(SendFileUtils.sent);SendFile.received.connect(SendFileUtils.received)};