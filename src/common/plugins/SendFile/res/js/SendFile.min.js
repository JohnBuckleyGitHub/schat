var SendFileUtils={button:function(a,b){return'<a class="btn btn-small btn-file-'+a+'" data-tr="file-'+a+'" href="chat-sendfile:'+a+"/"+b+'">'+Utils.tr("file-"+a)+"</a>"},setStateTr:function(c,b){var a=$("#"+c+" .file-state");a.html(Utils.tr(b));a.attr("data-tr",b);a.show()},setStateText:function(c,b){var a=$("#"+c+" .file-state");a.html(b);a.removeAttr("data-tr");a.show()},progress:function(c,b,a){SendFileUtils.setStateText(c,b);$("#"+c+" .file-progress .bar").css("width",a+"%")},setFileIcon:function(c){var a=$("#"+c).data("imageId");try{SendFile.fileIcon(c).assignToHTMLImageElement(document.getElementById(a));$("#"+a).show()}catch(b){$("#"+a).hide()}},updateState:function(e){if(!$("#"+e).length){return}var d=SendFile.role(e);var b=SendFile.state(e);if(b!="U"){$("#"+e+" .file-name").removeClass("file-only-name");$("#"+e+" .btn-small").remove();$("#"+e+" .file-progress").hide()}if(b=="W"){if(d){SendFileUtils.setStateText(e,SimpleChat.bytesToHuman(SendFile.size(e)));$("#"+e+" .file-buttons").append(SendFileUtils.button("saveas",e))}else{SendFileUtils.setStateTr(e,"file-waiting")}}else{if(b=="c"){SendFileUtils.setStateTr(e,"file-cancelled")}else{if(b=="C"){SendFileUtils.setStateTr(e,"file-connecting");$("#"+e+" .file-name").text(SendFile.fileName(e))}else{if(b=="T"){$("#"+e+" .file-progress").show();var a=SendFile.progressInfo(e);if(a.hasOwnProperty("text")){SendFileUtils.progress(e,a.text,a.percent)}}else{if(b=="F"){if(d){var c=SendFile.fileUrls(e);SendFileUtils.setStateText(e,'<span data-tr="file-received">'+Utils.tr("file-received")+'</span> <a href="'+c.dir+'" data-tr="file-show">'+Utils.tr("file-show")+"</a>");$("#"+e+" .file-buttons").append(SendFileUtils.button("open",e));$("#"+e+" .btn-file-open").attr("href",c.file)}else{SendFileUtils.setStateTr(e,"file-sent")}}}}}}if(b=="W"||b=="C"||b=="T"){$("#"+e+" .file-buttons").append(SendFileUtils.button("cancel",e))}alignChat()}};Messages.addFileMessage=function(c){var d=c.Id;var b=SimpleChat.randomId();var a='<div class="container '+c.Type+'-type" id="'+c.Id+'" data-time="'+c.Date+'">';a+='<div class="blocks '+c.Direction+'">';a+='<div class="file-sender">'+DateTime.template(c.Date,c.Day)+Messages.nameBlock(c.Author)+"</div>";a+='<div class="file-icon"><img id="'+b+'" src="" width="16" height="16" alt="" /></div>';a+='<div class="file-block"><span class="file-name file-only-name">'+c.File+'</span><br><span class="file-state">&nbsp;</span></div>';a+='<div class="file-buttons btn-group"></div>';a+='<div class="file-progress"><div class="bar"></div></div><div style="clear:both;"></div>';a+="</div></div>";Messages.addHintedRawMessage(a,c.Hint,d);$("#"+d).data("imageId",b);SendFileUtils.setFileIcon(d)};Messages.upgradeFileMessage=function(b){if(!$("#"+b.InternalId).length){return}$("#"+b.InternalId).attr("id",b.Id);$("#"+b.Id+" .btn-file-cancel").attr("href","chat-sendfile:cancel/"+b.Id);$("#"+b.Id).attr("data-time",b.Date);var a=new Date(b.Date);var c=$("#"+b.Id+" .date-time-block");c.children(".time").text(DateTime.time(a));c.children(".seconds").text(DateTime.seconds(a))};if(typeof SendFile==="undefined"){SendFile={state:function(a){return"U"},role:function(a){return 1},size:function(a){return 0},fileName:function(a){return""},progressInfo:function(a){return{}},fileUrls:function(a){return{}}}}else{SendFile.progress.connect(SendFileUtils.progress);SendFile.stateChanged.connect(SendFileUtils.updateState)}Messages.onAdd.push(SendFileUtils.updateState);