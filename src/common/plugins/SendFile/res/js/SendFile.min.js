var SendFileUtils={button:function(a,b){return'<a class="btn btn-small btn-file-'+a+'" data-tr="file-'+a+'" href="chat-sendfile:'+a+"/"+b+'">'+Utils.tr("file-"+a)+"</a>"},setStateTr:function(c,b){var a=$("#"+c+" .file-state");a.html(Utils.tr(b));a.attr("data-tr",b)},setStateText:function(c,b){var a=$("#"+c+" .file-state");a.html(b);a.removeAttr("data-tr")},cancelled:function(a){SendFileUtils.setStateTr(a,"file-cancelled");$("#"+a+" .file-buttons").remove();$("#"+a+" .file-progress").remove()},accepted:function(b,a){SendFileUtils.setStateTr(b,"file-connecting");$("#"+b+" .file-name").text(a);$("#"+b+" .btn-file-saveas").remove()},progress:function(c,b,a){SendFileUtils.setStateText(c,b);$("#"+c+" .file-progress .bar").css("width",a+"%")},sent:function(a){SendFileUtils.setStateTr(a,"file-sent");$("#"+a+" .file-buttons").remove();$("#"+a+" .file-progress").remove()},received:function(c,a,b){SendFileUtils.setStateText(c,'<span data-tr="file-received">'+Utils.tr("file-received")+'</span> <a href="'+a+'" data-tr="file-show">'+Utils.tr("file-show")+"</a>");$("#"+c+" .file-progress").remove();$("#"+c+" .btn-file-cancel").remove();$("#"+c+" .file-buttons").prepend(SendFileUtils.button("open",c));$("#"+c+" .btn-file-open").attr("href",b)}};Messages.addFileMessage=function(b){var c=b.Id;var a='<div class="container '+b.Type+'-type" id="'+b.Id+'">';a+='<div class="blocks '+b.Direction+'">';a+='<div class="file-sender">'+DateTime.template(b.Date,b.Day)+Messages.nameBlock(b.Author)+"</div>";a+='<div class="file-block"><span class="file-name">'+b.File+'</span><br><span class="file-state">&nbsp;</span></div>';a+='<div class="file-buttons btn-group">'+SendFileUtils.button("cancel",c)+"</div>";a+='<div class="file-progress"><div class="bar"></div></div><div style="clear:both;"></div>';a+="</div></div>";Messages.addHintedRawMessage(a,b.Hint,c);if(b.Direction==="outgoing"){SendFileUtils.setStateTr(c,"file-waiting")}else{SendFileUtils.setStateText(c,SimpleChat.bytesToHuman(b.Size));$("#"+c+" .file-buttons").prepend(SendFileUtils.button("saveas",c))}};if(typeof SendFile==="undefined"){SendFile={}}else{SendFile.cancelled.connect(SendFileUtils.cancelled);SendFile.accepted.connect(SendFileUtils.accepted);SendFile.progress.connect(SendFileUtils.progress);SendFile.sent.connect(SendFileUtils.sent);SendFile.received.connect(SendFileUtils.received)};